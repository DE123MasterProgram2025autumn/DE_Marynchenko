---
title: "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ5: –ï—Ñ–µ–∫—Ç–∏–≤–Ω–∞ —Ä–æ–±–æ—Ç–∞ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–∞–∫–µ—Ç–∞ data.table"
subtitle: "–Ü–Ω–∂–µ–Ω–µ—Ä—ñ—è –¥–∞–Ω–∏—Ö | –ö—Ä–ù–£ —ñ–º. –ú. –û—Å—Ç—Ä–æ–≥—Ä–∞–¥—Å—å–∫–æ–≥–æ"
author: "[–°–∏–¥–æ—Ä–µ–Ω–∫–æ –í–∞–ª–µ—Ä—ñ–π](https://www.linkedin.com/in/valeriy-sydorenko-6782279a/)"
date: last-modified
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 3
    toc-location: left
    sidebar: left
    collapse-level: 2
    code-fold: true
    code-overflow: wrap
    page-layout: full
    include-in-footer:
        text: |
            <hr>
            <footer style="text-align: center; font-size: 0.9em; color: #666;">
            <p>–í–∏–∫–æ–Ω–∞–≤(–ª–∞): <strong>–ú–∞—Ä–∏–Ω—á–µ–Ω–∫–æ –í–∞–ª–µ—Ä—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞</strong> | –ì—Ä—É–ø–∞: <strong>–ö–Ü-24-1–º</strong> | –í–∏–∫–ª–∞–¥–∞—á: –°–∏–¥–æ—Ä–µ–Ω–∫–æ –í.–ú.</p>
            <p>–ö—Ä–µ–º–µ–Ω—á—É—Ü—å–∫–∏–π –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç —ñ–º–µ–Ω—ñ –ú–∏—Ö–∞–π–ª–∞ –û—Å—Ç—Ä–æ–≥—Ä–∞–¥—Å—å–∫–æ–≥–æ &copy; 2025</p>
            </footer>
editor: visual
execute:
  echo: true
  warning: false
  message: false
---

## –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–û—Å–≤–æ—ó—Ç–∏ —Å—É—á–∞—Å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –æ–±—Å—è–≥–∞–º–∏ –¥–∞–Ω–∏—Ö —É R ‚Äî –ø–∞–∫–µ—Ç `data.table`. –ù–∞–≤—á–∏—Ç–∏—Å—è –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ **—à–≤–∏–¥–∫—ñ, –ø–∞–º‚Äô—è—Ç—å-–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó** –Ω–∞–¥ –º—ñ–ª—å–π–æ–Ω–∞–º–∏ —Ä—è–¥–∫—ñ–≤: —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é, –∞–≥—Ä–µ–≥–∞—Ü—ñ—é, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –∑–ª–∏—Ç—Ç—è ‚Äî –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º **—É–Ω—ñ–∫–∞–ª—å–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É `DT[i, j, by]`**. –ó—Ä–æ–∑—É–º—ñ—Ç–∏, —á–æ–º—É `data.table` —î –∫–ª—é—á–æ–≤–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º —ñ–Ω–∂–µ–Ω–µ—Ä–∞ –¥–∞–Ω–∏—Ö –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏.

## –©–æ –≤–∏ –±—É–¥–µ—Ç–µ –≤–º—ñ—Ç–∏ –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏?

‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **—Å–∏–Ω—Ç–∞–∫—Å–∏—Å `DT[i, j, by]`** –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó (`i`), –æ–±—á–∏—Å–ª–µ–Ω–Ω—è (`j`) —Ç–∞ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è (`by`).\
‚úÖ –í–∏–∫–æ–Ω—É–≤–∞—Ç–∏ **–∞–≥—Ä–µ–≥–∞—Ü—ñ—é —Ç–∞ –ø—ñ–¥—Å—É–º–æ–≤—É–≤–∞–Ω–Ω—è** –∑–∞ –≥—Ä—É–ø–∞–º–∏ –∑—ñ —à–≤–∏–¥–∫—ñ—Å—Ç—é, —è–∫–∞ –ø–µ—Ä–µ–≤–µ—Ä—à—É—î `dplyr` —É 10‚Äì100 —Ä–∞–∑—ñ–≤.\
‚úÖ –û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ **–Ω–∞ –º—ñ—Å—Ü—ñ (by reference)** –±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ø—ñ–π ‚Äî —â–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –ø–∞–º‚Äô—è—Ç—ñ.\
‚úÖ –í–∏–∫–æ–Ω—É–≤–∞—Ç–∏ **–∑–ª–∏—Ç—Ç—è —Ç–∞–±–ª–∏—Ü—å (`merge`)** –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `on =` –∞–±–æ `key`.\
‚úÖ –ü–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ `data.frame` —É `data.table` —Ç–∞ –Ω–∞–≤–ø–∞–∫–∏ –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.\
‚úÖ –ü—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ **–≤–µ–ª–∏–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏** (CSV, TSV) –Ω–∞–ø—Ä—è–º—É —á–µ—Ä–µ–∑ `fread()` ‚Äî —à–≤–∏–¥—à–µ –∑–∞ `vroom` —É –¥–µ—è–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö.\
‚úÖ –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ `data.table` —É **—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –∫–æ–Ω–≤–µ—î—Ä–∏**, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.

–î–∏–≤. [@datatable2025]

## –í—Å—Ç—É–ø

–£ —Å–≤—ñ—Ç—ñ —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó –¥–∞–Ω–∏—Ö —á–∞—Å—Ç–æ –¥–æ–≤–æ–¥–∏—Ç—å—Å—è –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –æ–±—Å—è–≥–∞–º–∏, —è–∫—ñ **–ø–µ—Ä–µ–≤–∏—â—É—é—Ç—å –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É –ø–∞–º‚Äô—è—Ç—å** –∞–±–æ –º—ñ—Å—Ç—è—Ç—å **–º—ñ–ª—å–π–æ–Ω–∏/–º—ñ–ª—å—è—Ä–¥–∏ —Ä—è–¥–∫—ñ–≤**. –£ —Ç–∞–∫–∏—Ö —É–º–æ–≤–∞—Ö –Ω–∞–≤—ñ—Ç—å –Ω–∞–π–µ–ª–µ–≥–∞–Ω—Ç–Ω—ñ—à–∏–π –∫–æ–¥ –Ω–∞ `dplyr` —Å—Ç–∞—î –ø–æ–≤—ñ–ª—å–Ω–∏–º —ñ —Ä–µ—Å—É—Ä—Å–æ—î–º–Ω–∏–º.

–ü–∞–∫–µ—Ç `data.table` ‚Äî —Ü–µ **–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞** –¥–ª—è —Ç–∞–∫–∏—Ö –∑–∞–≤–¥–∞–Ω—å. –í—ñ–Ω –ø–æ—î–¥–Ω—É—î:\
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å C-—Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó** (–±–∞–≥–∞—Ç–æ –æ–ø–µ—Ä–∞—Ü—ñ–π –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –∑–∞ $O(1)$ –∞–±–æ $O(log n))$\
- **–ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ** (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ü—ñ, lazy evaluation)\
- **–ö–æ–º–ø–∞–∫—Ç–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å** (`DT[i, j, by]` –∑–∞–º—ñ—Å—Ç—å –¥–æ–≤–≥–∏—Ö –∫–æ–Ω–≤–µ—î—Ä—ñ–≤).

–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ `dplyr`, —è–∫–∏–π –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–π –Ω–∞ **—á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å**, `data.table` –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–π –Ω–∞ **–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** ‚Äî —Å–∞–º–µ —Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —ñ–Ω–∂–µ–Ω–µ—Ä—É –¥–∞–Ω–∏—Ö.

–¶—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ –∑–Ω–∞–π–æ–º–∏—Ç—å –≤–∞—Å —ñ–∑:

-   –±–∞–∑–æ–≤–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º `data.table`

-   —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é, –∞–≥—Ä–µ–≥–∞—Ü—ñ—î—é, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º

-   –∑–ª–∏—Ç—Ç—è–º —Ç–∞–±–ª–∏—Ü—å

-   –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ —á–µ—Ä–µ–∑ `fread()`.

–ú–∏ –Ω–∞–≤—á–∏–º–æ—Å—è **—Ä–æ–±–∏—Ç–∏ —Ç–µ —Å–∞–º–µ, —â–æ –π —É `dplyr`**, –∞–ª–µ **–∑–Ω–∞—á–Ω–æ —à–≤–∏–¥—à–µ —ñ –∑ –º–µ–Ω—à–∏–º —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è–º –ø–∞–º‚Äô—è—Ç—ñ** ‚Äî —â–æ —î –∫—Ä–∏—Ç–∏—á–Ω–∏–º —É production-—Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö.

## –°–∏–Ω—Ç–∞–∫—Å–∏—Å `DT[i, j, by]`: —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è, –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Ç–∞ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è

–ü–∞–∫–µ—Ç `data.table` –≤–≤–æ–¥–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π —ñ —à–≤–∏–¥–∫–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `DT[i, j, by]`, —è–∫–∏–π –æ–±‚Äô—î–¥–Ω—É—î —Ç—Ä–∏ –∫–ª—é—á–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤ –æ–¥–Ω–æ–º—É –≤–∏—Ä–∞–∑—ñ:

-   **`i`** ‚Äî —É–º–æ–≤–∞ **—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ä—è–¥–∫—ñ–≤** (–∞–Ω–∞–ª–æ–≥ `filter()` —É `dplyr`);

-   **`j`** ‚Äî –≤–∏—Ä–∞–∑ –¥–ª—è **–æ–±—á–∏—Å–ª–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤** –∞–±–æ **–≤–∏–±–æ—Ä—É —ñ—Å–Ω—É—é—á–∏—Ö** (–∞–Ω–∞–ª–æ–≥ `select()`/`mutate()`);

-   **`by`** ‚Äî –∑–º—ñ–Ω–Ω—ñ –¥–ª—è **–≥—Ä—É–ø—É–≤–∞–Ω–Ω—è** (–∞–Ω–∞–ª–æ–≥ `group_by()`).

#### üîπ –ü—Ä–∏–∫–ª–∞–¥ 1: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è (`i`)

–ó–∞–≤–∞–Ω—Ç–∞–∂–∏–º–æ –¥–∞–Ω—ñ:

```{r}
library(data.table)

input <- if (file.exists("flights14.csv")) {
  "flights14.csv"
} else {
  "https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv"
}
flights <- fread(input)
```

–¢–µ–ø–µ—Ä –∑–Ω–∞–π–¥–µ–º–æ –≤—Å—ñ —Ä–µ–π—Å–∏ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó `"AA"` (American Airlines):

```{r}
flights[carrier == "AA"]
```

–¶–µ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ `dplyr::filter(flights, carrier == "AA")`, –∞–ª–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–∑–Ω–∞—á–Ω–æ —à–≤–∏–¥—à–µ**, –æ—Å–∫—ñ–ª—å–∫–∏ `data.table` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **—ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—é** —Ç–∞ **–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π C-–∫–æ–¥**.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥ 2: –û–±—á–∏—Å–ª–µ–Ω–Ω—è (`j`)

–í–∏–±–µ—Ä–µ–º–æ –ª–∏—à–µ —Å—Ç–æ–≤–ø—Ü—ñ `origin`, `dest`, `dep_delay` —Ç–∞ –æ–±—á–∏—Å–ª–∏–º–æ –Ω–æ–≤–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å ‚Äî **–∑–∞–≥–∞–ª—å–Ω—É —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø–æ–ª—å–æ—Ç—É –≤ —Ö–≤–∏–ª–∏–Ω–∞—Ö**:

```{r}
flights[, .(origin, dest, dep_delay, total_time = air_time + dep_delay)]
```

–¢—É—Ç:

-   `.()` ‚Äî —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –¥–ª—è `list()`, —è–∫–µ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π `data.table`;

-   `total_time` ‚Äî –Ω–æ–≤–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å, –æ–±—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ –ª—å–æ—Ç—É.

–¶–µ –∑–∞–º—ñ–Ω—é—î –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é `select()` + `mutate()` —É `dplyr`.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥ 3: –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è (`by`)

–û–±—á–∏—Å–ª–∏–º–æ **—Å–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É** (`dep_delay`) –∑–∞ –∫–æ–∂–Ω–æ—é –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—î—é:

```{r}
flights[, .(avg_delay = mean(dep_delay, na.rm = TRUE)), by = carrier]
```

–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Ç–∞–±–ª–∏—Ü—è –∑ –¥–≤–æ–º–∞ —Å—Ç–æ–≤–ø—Ü—è–º–∏: `carrier` —Ç–∞ `avg_delay`.

–ú–æ–∂–Ω–∞ –≥—Ä—É–ø—É–≤–∞—Ç–∏ –∑–∞ **–∫—ñ–ª—å–∫–æ–º–∞ –∑–º—ñ–Ω–Ω–∏–º–∏**:

```{r}
flights[, .(avg_delay = mean(dep_delay, na.rm = TRUE)), by = .(carrier, origin)]
```

#### üîπ –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥

–ó–Ω–∞–π–¥–µ–º–æ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –ø—Ä–∏–±—É—Ç—Ç—è** (`arr_delay`) –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∞–µ—Ä–æ–ø–æ—Ä—Ç—É –≤–∏–ª—å–æ—Ç—É (`origin`), –∞–ª–µ **–ª–∏—à–µ –¥–ª—è —Ä–µ–π—Å—ñ–≤ –∑ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è–º –≤–∏–ª—å–æ—Ç—É \> 60 —Ö–≤**:

```{r}
flights[dep_delay > 60, .(max_arr_delay = max(arr_delay, na.rm = TRUE)), by = origin]
```

–¢—É—Ç:

-   `i = dep_delay > 60` ‚Äî —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è,

-   `j = .(max_arr_delay = ...)` ‚Äî –∞–≥—Ä–µ–≥–∞—Ü—ñ—è,

-   `by = origin` ‚Äî –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è.

------------------------------------------------------------------------

### ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É `DT[i, j, by]`:

-   **–ö–æ–º–ø–∞–∫—Ç–Ω—ñ—Å—Ç—å**: –æ–¥–Ω–∞ –ª—ñ–Ω—ñ–π–∫–∞ –∑–∞–º—ñ—Å—Ç—å –∫—ñ–ª—å–∫–æ—Ö —É `dplyr`.

-   **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –Ω–∞ C-—Ä—ñ–≤–Ω—ñ.

-   **–ß–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å**: –ª–æ–≥—ñ–∫–∞ "—Ñ—ñ–ª—å—Ç—Ä—É–π ‚Üí –æ–±—á–∏—Å–ª–∏ ‚Üí –≥—Ä—É–ø—É–π" –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–∞ –ø—Ä—è–º–æ –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—ñ.

-   **–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø–∞–º‚Äô—è—Ç—ñ**: –Ω–µ–º–∞—î –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –∫–æ–ø—ñ–π –¥–∞–Ω–∏—Ö.

------------------------------------------------------------------------

–¶–µ–π –ø—ñ–¥—Ö—ñ–¥ —î **–æ—Å–Ω–æ–≤–æ—é —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó –¥–∞–Ω–∏—Ö —É `data.table`** —ñ –¥–æ–∑–≤–æ–ª—è—î –æ–±—Ä–æ–±–ª—è—Ç–∏ –º—ñ–ª—å–π–æ–Ω–∏ —Ä—è–¥–∫—ñ–≤ –∑–∞ –¥–æ–ª—ñ —Å–µ–∫—É–Ω–¥–∏ ‚Äî —Å–∞–º–µ —Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤ production-—Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.

## –®–≤–∏–¥–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –∑–∞ –≥—Ä—É–ø–∞–º–∏

–£ `data.table` –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –∑–∞ –≥—Ä—É–ø–∞–º–∏ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–∑–Ω–∞—á–Ω–æ —à–≤–∏–¥—à–µ**, –Ω—ñ–∂ —É `dplyr`, –∑–∞–≤–¥—è–∫–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ **—Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ñ** —Ç–∞ **–≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó**. –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –∫–æ–º–ø–∞–∫—Ç–Ω–∏–º: –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑–∞–¥–∞—î—Ç—å—Å—è —É —Ç—Ä–µ—Ç—å–æ–º—É –∞—Ä–≥—É–º–µ–Ω—Ç—ñ `by`.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: —Å–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É –∑–∞ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—î—é

–¢–µ–ø–µ—Ä –æ–±—á–∏—Å–ª–∏–º–æ —Å–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É (`dep_delay`) –¥–ª—è –∫–æ–∂–Ω–æ—ó –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó (`carrier`):

```{r}
flights[, .(avg_delay = mean(dep_delay, na.rm = TRUE)), by = carrier]
```

–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–∞ —Ç–∞–±–ª–∏—Ü—è –∑ –¥–≤–æ–º–∞ —Å—Ç–æ–≤–ø—Ü—è–º–∏: `carrier` —Ç–∞ `avg_delay`.

#### üîπ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ `dplyr`

–¢–æ–π —Å–∞–º–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É `dplyr`:

```{r}
library(dplyr)
flights_df <- as.data.frame(flights)
flights_df %>%
  group_by(carrier) %>%
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE))
```

–ê–ª–µ `data.table`:

-   **–Ω–µ —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –∫–æ–ø—ñ–π**

-   **–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ 10‚Äì100 —Ä–∞–∑—ñ–≤ —à–≤–∏–¥—à–µ** –Ω–∞ –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö

-   **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–µ–Ω—à–µ –ø–∞–º‚Äô—è—Ç—ñ**

#### üîπ –ê–≥—Ä–µ–≥–∞—Ü—ñ—è –∑–∞ –∫—ñ–ª—å–∫–æ–º–∞ –∑–º—ñ–Ω–Ω–∏–º–∏

–ú–æ–∂–Ω–∞ –≥—Ä—É–ø—É–≤–∞—Ç–∏ –∑–∞ –¥–µ–∫—ñ–ª—å–∫–æ–º–∞ –∑–º—ñ–Ω–Ω–∏–º–∏:

```{r}
flights[, .(avg_delay = mean(dep_delay, na.rm = TRUE)), by = .(carrier, origin)]
```

–¶–µ –¥–∞—Å—Ç—å —Å–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó —Ç–∞ –∞–µ—Ä–æ–ø–æ—Ä—Ç—É –≤–∏–ª—å–æ—Ç—É.

#### üîπ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–µ–∫—ñ–ª—å–∫–æ—Ö –∞–≥—Ä–µ–≥–∞—Ç–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π

```{r}
flights[, .(
  avg_delay = mean(dep_delay, na.rm = TRUE),
  max_delay = max(dep_delay, na.rm = TRUE),
  n_flights = .N
), by = carrier]
```

–¢—É—Ç:

-   `.N` ‚Äî –≤–±—É–¥–æ–≤–∞–Ω–∞ –∑–º—ñ–Ω–Ω–∞, —â–æ –º—ñ—Å—Ç–∏—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤ —É –≥—Ä—É–ø—ñ.

------------------------------------------------------------------------

### ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó –≤ `data.table`:

-   **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –Ω–∞ —Ä—ñ–≤–Ω—ñ C.

-   **–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø–∞–º‚Äô—è—Ç—ñ**: –Ω–µ–º–∞—î –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö.

-   **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å–∫–ª–∞–¥–Ω–∏—Ö –∞–≥—Ä–µ–≥–∞—Ç—ñ–≤ —É –æ–¥–Ω–æ–º—É –≤–∏—Ä–∞–∑—ñ.

-   **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –ø—Ä–∞—Ü—é—î –∑ –º—ñ–ª—å–π–æ–Ω–∞–º–∏/–º—ñ–ª—å—è—Ä–¥–∞–º–∏ —Ä—è–¥–∫—ñ–≤ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.

## –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –Ω–∞ –º—ñ—Å—Ü—ñ (by reference)

–û–¥–Ω—ñ—î—é –∑ –∫–ª—é—á–æ–≤–∏—Ö –ø–µ—Ä–µ–≤–∞–≥ `data.table` —î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å **–æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ –º—ñ—Å—Ü—ñ** (in-place), —Ç–æ–±—Ç–æ **–±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–ø—ñ–π –æ–±‚Äô—î–∫—Ç–∞**. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `:=`, —è–∫–∏–π –ø—Ä–∞—Ü—é—î **by reference** ‚Äî –ø—Ä—è–º–æ –≤ –ø–∞–º‚Äô—è—Ç—ñ, –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤.

–¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏, –¥–µ –∫–æ–∂–Ω–∞ –∫–æ–ø—ñ—è –º–æ–∂–µ –∑–∞–π–º–∞—Ç–∏ –≥—ñ–≥–∞–±–∞–π—Ç–∏ –ø–∞–º‚Äô—è—Ç—ñ.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è

–î–æ–¥–∞–º–æ —Å—Ç–æ–≤–ø–µ—Ü—å `speed` (—à–≤–∏–¥–∫—ñ—Å—Ç—å —É –º–∏–ª—è—Ö –Ω–∞ –≥–æ–¥–∏–Ω—É) –¥–æ –¥–∞—Ç–∞—Å–µ—Ç—É `flights`:

```{r}
# –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å –ù–ê –ú–Ü–°–¶–Ü
flights[, speed := distance / (air_time / 60)]
```

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ:

-   `flights` –º—ñ—Å—Ç–∏—Ç—å –Ω–æ–≤–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å `speed`

-   **–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π –æ–±‚Äô—î–∫—Ç**

-   **–ø–∞–º‚Äô—è—Ç—å –Ω–µ –∑–±—ñ–ª—å—à–∏–ª–∞—Å—è** –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω–æ —Ä–æ–∑–º—ñ—Ä—É —Ç–∞–±–ª–∏—Ü—ñ.

#### üîπ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ `dplyr`

–£ `dplyr` —Ç–æ–π —Å–∞–º–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–º–∞–≥–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–±‚Äô—î–∫—Ç–∞:

```{r}
flights_df <- as.data.frame(flights)
flights_df <- flights_df %>% mutate(speed = distance / (air_time / 60))
```

–¢—É—Ç:

-   —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∞ –∫–æ–ø—ñ—è `flights_df`,

-   —Å—Ç–∞—Ä–∞ –≤–µ—Ä—Å—ñ—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ –ø–∞–º‚Äô—è—Ç—ñ, –¥–æ–∫–∏ –Ω–µ –±—É–¥–µ –∑—ñ–±—Ä–∞–Ω–∞ –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è,

-   –≤–∏—Ç—Ä–∞—á–∞—î—Ç—å—Å—è —á–∞—Å –Ω–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –º—ñ–ª—å–π–æ–Ω—ñ–≤ –∑–Ω–∞—á–µ–Ω—å.

#### üîπ –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ–≥–æ —Å—Ç–æ–≤–ø—Ü—è

–ú–æ–∂–Ω–∞ —Ç–∞–∫–æ–∂ **–æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —ñ—Å–Ω—É—é—á—ñ —Å—Ç–æ–≤–ø—Ü—ñ**:

```{r}
# –ó–∞–º—ñ–Ω–∏–º–æ –≤—ñ–¥‚Äô—î–º–Ω—ñ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –Ω–∞ 0
flights[dep_delay < 0, dep_delay := 0]
```

–¶–µ ‚Äî **—É–º–æ–≤–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ü—ñ**, —è–∫–µ –Ω–µ —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.

#### üîπ –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–æ–≤–ø—Ü—ñ–≤

–í–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–æ–≤–ø—Ü—ñ–≤ —Ç–∞–∫–æ–∂ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–∞ –º—ñ—Å—Ü—ñ:

```{r}
flights[, c("hour") := NULL]
```

------------------------------------------------------------------------

### ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ü—ñ:

-   **–ï–∫–æ–Ω–æ–º—ñ—è –ø–∞–º‚Äô—è—Ç—ñ**: –Ω–µ–º–∞—î –¥—É–±–ª—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö.

-   **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –º–∏—Ç—Ç—î–≤–æ, –Ω–∞–≤—ñ—Ç—å –Ω–∞ –º—ñ–ª—å–π–æ–Ω–∞—Ö —Ä—è–¥–∫—ñ–≤.

-   **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏, —â–æ –ø–µ—Ä–µ–≤–∏—â—É—é—Ç—å RAM.

-   **–ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥—É**: –Ω–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ —É –ø—Ä–∏—Å–≤–æ—î–Ω–Ω—ñ (`<-`) –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó.

## –ó–ª–∏—Ç—Ç—è —Ç–∞–±–ª–∏—Ü—å —á–µ—Ä–µ–∑ `merge()` —Ç–∞ –∫–ª—é—á—ñ

–£ —Ä–µ–∞–ª—å–Ω–∏—Ö ETL-–ø—Ä–æ—Ü–µ—Å–∞—Ö –¥–∞–Ω—ñ —á–∞—Å—Ç–æ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ –º—ñ–∂ –∫—ñ–ª—å–∫–æ–º–∞ —Ç–∞–±–ª–∏—Ü—è–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–µ–π—Å–∏, –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó, –ª—ñ—Ç–∞–∫–∏, –ø–æ–≥–æ–¥—É). –î–ª—è —ó—Ö –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è `data.table` –Ω–∞–¥–∞—î **–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –∑–ª–∏—Ç—Ç—è**, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å —à–≤–∏–¥—à–µ –∑–∞ –∞–Ω–∞–ª–æ–≥–∏ –≤ `dplyr`.

#### üîπ –î–≤–∞ –ø—ñ–¥—Ö–æ–¥–∏ –¥–æ –∑–ª–∏—Ç—Ç—è:

1.  **–ß–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç `on =`** ‚Äî –Ω–µ –≤–∏–º–∞–≥–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:

    ```{r}
    # –ü—Ä–∏–∫–ª–∞–¥: –¥–æ–¥–∞—î–º–æ –Ω–∞–∑–≤—É –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó –¥–æ —Ä–µ–π—Å—ñ–≤
    airlines <- data.table(carrier = c("AA", "UA", "DL"), 
                           name = c("American", "United", "Delta"))
    setkey(airlines, carrier)  # –Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ, –∞–ª–µ –ø—Ä–∏—Å–∫–æ—Ä—é—î

    flights[airlines, on = "carrier", name := i.name]
    ```

    –¢—É—Ç `i.name` ‚Äî —Ü–µ —Å—Ç–æ–≤–ø–µ—Ü—å `name` –∑ —Ç–∞–±–ª–∏—Ü—ñ `airlines` (–ø—Ä–µ—Ñ—ñ–∫—Å `i.` –ø–æ–∑–Ω–∞—á–∞—î "—ñ–Ω—à—É" —Ç–∞–±–ª–∏—Ü—é).

2.  **–ß–µ—Ä–µ–∑ –∫–ª—é—á—ñ (`setkey()`)** ‚Äî –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó —à–≤–∏–¥–∫–æ—Å—Ç—ñ:

    ```{r}
    setkey(flights, carrier)
    setkey(airlines, carrier)
    merged <- flights[airlines]
    ```

    –ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–ª—é—á–∞ –∑–ª–∏—Ç—Ç—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞ **–±—ñ–Ω–∞—Ä–Ω–∏–º –ø–æ—à—É–∫–æ–º** ($O(log n)$), —â–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö.

#### üîπ –¢–∏–ø–∏ –∑–ª–∏—Ç—Ç—è:

-   **`X[Y]`** ‚Äî –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç `left_join` —É `dplyr` (–∑–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ —Ä—è–¥–∫–∏ –∑ `X`).

-   **`Y[X]`** ‚Äî –∑–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ —Ä—è–¥–∫–∏ –∑ `Y`.

-   –î–ª—è **–≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∑–ª–∏—Ç—Ç—è** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `nomatch = NULL`:

    ```{r}
    flights[airlines, nomatch = NULL]
    ```

#### üîπ –ü–µ—Ä–µ–≤–∞–≥–∏ –∑–ª–∏—Ç—Ç—è –≤ `data.table`:

-   **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ —Ç–∞ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É.

-   **–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø–∞–º‚Äô—è—Ç—ñ**: –Ω–µ–º–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –∫–æ–ø—ñ–π –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –Ω–∞ –º—ñ—Å—Ü—ñ.

-   **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —É–º–æ–≤–Ω–∏—Ö –∑–ª–∏—Ç—Ç—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `on = .(carrier, origin)`).

## –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—ñ–∂ `data.frame` —Ç–∞ `data.table`

–ü–∞–∫–µ—Ç `data.table` –ø–æ–≤–Ω—ñ—Å—Ç—é —Å—É–º—ñ—Å–Ω–∏–π –∑ –±–∞–∑–æ–≤–∏–º –∫–ª–∞—Å–æ–º `data.frame`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ª–µ–≥–∫–æ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –π–æ–≥–æ –≤ —ñ—Å–Ω—É—é—á—ñ –ø—Ä–æ—î–∫—Ç–∏ –±–µ–∑ –ø–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –∫–æ–¥—É. –ö–ª—é—á–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è:

-   **`setDT()`** ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î `data.frame` –Ω–∞ `data.table` **–Ω–∞ –º—ñ—Å—Ü—ñ** (–±–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è).

-   **`setDF()`** ‚Äî –Ω–∞–≤–ø–∞–∫–∏, –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î `data.table` –Ω–∞–∑–∞–¥ —É `data.frame` **–Ω–∞ –º—ñ—Å—Ü—ñ**.

-   **`as.data.table()`** ‚Äî —Å—Ç–≤–æ—Ä—é—î **–Ω–æ–≤–∏–π –æ–±‚Äô—î–∫—Ç** `data.table` (–∞–Ω–∞–ª–æ–≥ `as.data.frame()`).

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è `data.frame` ‚Üí `data.table`

```{r}
library(data.table)

# –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ —è–∫ data.frame (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ read.csv)
flights_df <- read.csv("data/flights14.csv")

# –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –ù–ê –ú–Ü–°–¶–Ü
setDT(flights_df)

# –¢–µ–ø–µ—Ä flights_df ‚Äî —Ü–µ data.table
class(flights_df)  # "data.table" "data.frame"
```

> üí° **–ü–µ—Ä–µ–≤–∞–≥–∞ `setDT()`**: –Ω–µ —Å—Ç–≤–æ—Ä—é—î –∫–æ–ø—ñ—ó, —Ç–æ–º—É –ø–∞–º‚Äô—è—Ç—å –Ω–µ –ø–æ–¥–≤–æ—é—î—Ç—å—Å—è ‚Äî –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è `data.table` ‚Üí `data.frame`

```{r}
# –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –¥–æ data.frame (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ ggplot2)
setDF(flights_df)
class(flights_df)  # "data.frame"
```

#### üîπ –ö–æ–ª–∏ —Ü–µ –∫–æ—Ä–∏—Å–Ω–æ?

-   –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ `read.csv()` –∞–±–æ `vroom()` ‚Üí –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç–µ –Ω–∞ `data.table` –¥–ª—è —à–≤–∏–¥–∫–æ—ó –æ–±—Ä–æ–±–∫–∏.

-   –ü—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ –¥–∞–Ω—ñ –≤ –ø–∞–∫–µ—Ç, —â–æ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î `data.table` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–µ—è–∫—ñ –º–æ–¥–µ–ª—ñ) ‚Üí –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç–µ –Ω–∞–∑–∞–¥.

## –®–≤–∏–¥–∫–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ —á–µ—Ä–µ–∑ `fread()`

–§—É–Ω–∫—Ü—ñ—è `fread()` ‚Äî —Ü–µ –æ–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —É R –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ (CSV, TSV, —ñ–Ω—à—ñ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∏). –í–æ–Ω–∞ —î —á–∞—Å—Ç–∏–Ω–æ—é –ø–∞–∫–µ—Ç–∞ `data.table` —ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è **–º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö**, –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ —Ñ–∞–π–ª–∏ –º–∞—é—Ç—å **–≥—ñ–≥–∞–±–∞–π—Ç–∏**.

#### üîπ –ö–ª—é—á–æ–≤—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ `fread()`:

-   **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∞, –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö.

-   **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ URL**: –º–æ–∂–Ω–∞ —á–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª–∏ –ø—Ä—è–º–æ –∑ GitHub, S3 —Ç–æ—â–æ.

-   **–ß–∞—Å—Ç–∫–æ–≤–µ —á–∏—Ç–∞–Ω–Ω—è**: –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª–∏—à–µ –ø–µ—Ä—à—ñ `n` —Ä—è–¥–∫—ñ–≤ (`nrows`), –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –ø–µ—Ä—à—ñ `skip` —Ä—è–¥–∫—ñ–≤.

-   **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å—Ç–∏—Å–Ω–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤**: `.csv.gz`, `.csv.bz2` –±–µ–∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Ä–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è.

-   **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: —á–∞—Å—Ç–æ –ø–µ—Ä–µ–≤–µ—Ä—à—É—î `vroom` —É —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–ª–∏ —î –±–∞–≥–∞—Ç–æ `NA`, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∏).

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ —Ä–µ–π—Å–∏

```{r}
library(data.table)

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª—É –∞–±–æ –∑ GitHub
input <- if (file.exists("flights14.csv")) {
  "flights14.csv"
} else {
  "https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv"
}

flights <- fread(input)
```

–¶–µ–π –∫–æ–¥:

-   –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç—å, —â–æ —Ü–µ CSV –∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º,

-   –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç—å —Ç–∏–ø–∏ (`integer`, `character`, —Ç–æ—â–æ),

-   –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å 253 316 —Ä—è–¥–∫—ñ–≤ –∑–∞ **–¥–æ–ª—ñ —Å–µ–∫—É–Ω–¥–∏**.

#### üîπ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ `read.csv()` —Ç–∞ `vroom()`

-   `read.csv()` ‚Äî –ø–æ–≤—ñ–ª—å–Ω–∏–π, —Å—Ç–≤–æ—Ä—é—î `data.frame`, –≤–∏–º–∞–≥–∞—î —Ä—É—á–Ω–æ–≥–æ –≤–∫–∞–∑—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.

-   `vroom()` ‚Äî —à–≤–∏–¥–∫–∏–π, –∞–ª–µ —ñ–Ω–æ–¥—ñ –º–µ–Ω—à –Ω–∞–¥—ñ–π–Ω–∏–π –ø—Ä–∏ —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö.

-   `fread()` ‚Äî **–Ω–∞–π–±—ñ–ª—å—à –Ω–∞–¥—ñ–π–Ω–∏–π —ñ —à–≤–∏–¥–∫–∏–π** –¥–ª—è ETL-–ø—Ä–æ—Ü–µ—Å—ñ–≤ —É production.

#### üîπ –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

```{r}
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª–∏—à–µ –ø–µ—Ä—à—ñ 1000 —Ä—è–¥–∫—ñ–≤
fread(input, nrows = 1000)

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –ø–µ—Ä—à—ñ 100 —Ä—è–¥–∫—ñ–≤
fread(input, skip = 100)

# –í–∫–∞–∑–∞—Ç–∏ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫ —è–≤–Ω–æ (—è–∫—â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–æ)
fread(input, sep = "\t")
```

–¶–µ —Ä–æ–±–∏—Ç—å `fread()` **—ñ–¥–µ–∞–ª—å–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –ø–µ—Ä—à–æ–≥–æ –µ—Ç–∞–ø—É ETL-–∫–æ–Ω–≤–µ—î—Ä–∞** ‚Äî –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ —à–≤–∏–¥–∫–æ —ñ –Ω–∞–¥—ñ–π–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–±—Ä–æ–±–∫–∏.

## –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è `data.table` —É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –∫–æ–Ω–≤–µ—î—Ä–∏

–•–æ—á–∞ `data.table` –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –æ–ø–µ—Ä–∞—Ç–æ—Ä `%>%` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (—á–µ—Ä–µ–∑ —Å–≤–æ—é –≤–ª–∞—Å–Ω—É –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é —á–µ—Ä–µ–∑ `[...]`), –π–æ–≥–æ –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ **—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –∫–æ–Ω–≤–µ—î—Ä–∏**, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ —è–∫ **—á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å**, —Ç–∞–∫ —ñ **–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –ª–∞–Ω—Ü—é–∂–æ–∫ –æ–ø–µ—Ä–∞—Ü—ñ–π –±–µ–∑ `%>%`

```{r}
# –û–±—á–∏—Å–ª–∏—Ç–∏ —Å–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É –∑–∞ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—î—é –¥–ª—è —Ä–µ–π—Å—ñ–≤ –∑ JFK
result <- flights[origin == "JFK", .(avg_delay = mean(dep_delay, na.rm = TRUE)), by = carrier]
```

–¶–µ–π –∫–æ–¥ –≤–∂–µ —î **–∫–æ–º–ø–∞–∫—Ç–Ω–∏–º —ñ —à–≤–∏–¥–∫–∏–º**, –∞–ª–µ —ñ–Ω–æ–¥—ñ –±–∞–∂–∞–Ω–æ –ø–æ—î–¥–Ω–∞—Ç–∏ `data.table` –∑ —ñ–Ω—à–∏–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ (`ggplot2`, `purrr`, —Ç–æ—â–æ).

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –ø–æ—î–¥–Ω–∞–Ω–Ω—è –∑ `%>%` (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

```{r}
library(dplyr) # –¥–ª—è %>% (—Ö–æ—á–∞ —Ç–µ—Ö–Ω—ñ—á–Ω–æ –≤—ñ–Ω –∑ magrittr)

flights %>%
  .[origin == "JFK"] %>%
  .[, .(avg_delay = mean(dep_delay, na.rm = TRUE)), by = carrier] %>%
  .[order(-avg_delay)]
```

–¢—É—Ç `.` –ø–æ–∑–Ω–∞—á–∞—î –ø–æ—Ç–æ—á–Ω–∏–π –æ–±‚Äô—î–∫—Ç —É –∫–æ–Ω–≤–µ—î—Ä—ñ. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `%>%` —Ä–∞–∑–æ–º —ñ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º `data.table`.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ `ggplot2`

```{r}
library(ggplot2)

flights[origin == "JFK", .(avg_delay = mean(dep_delay, na.rm = TRUE)), by = carrier] %>%
  ggplot(aes(x = reorder(carrier, avg_delay), y = avg_delay)) +
  geom_col() +
  coord_flip() +
  labs(title = "–°–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É –∑ JFK –∑–∞ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—î—é")
```

#### üîπ –ö–æ–ª–∏ –≤–∞—Ä—Ç–æ —É–Ω–∏–∫–∞—Ç–∏ `%>%`?

-   –ö–æ–ª–∏ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–±–∞–≥–∞—Ç–æ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π `data.table`** ‚Äî –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–ª–∞–Ω—Ü—é–∂–∫–∏ —á–µ—Ä–µ–∑ `[...]`** –∞–±–æ **–ø—Ä–æ–º—ñ–∂–Ω—ñ –∑–º—ñ–Ω–Ω—ñ**, —â–æ–± –Ω–µ –≤—Ç—Ä–∞—á–∞—Ç–∏ –ø–µ—Ä–µ–≤–∞–≥–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó.

-   –ö–æ–ª–∏ –≤–∞–∂–ª–∏–≤–∞ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å** ‚Äî –∫–æ–∂–µ–Ω `%>%` –¥–æ–¥–∞—î –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏.

#### üîπ –ë–∞–ª–∞–Ω—Å: —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å vs –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

-   –î–ª—è **—ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É** ‚Äî –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `%>%` –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ.

-   –î–ª—è **production-–∫–æ–¥—É** ‚Äî –∫—Ä–∞—â–µ –ø–∏—Å–∞—Ç–∏ —á–∏—Å—Ç–∏–π `data.table` –±–µ–∑ `%>%`.

–¶—è –≥–Ω—É—á–∫—ñ—Å—Ç—å —Ä–æ–±–∏—Ç—å `data.table` **—ñ–¥–µ–∞–ª—å–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è —ñ–Ω–∂–µ–Ω–µ—Ä–∞ –¥–∞–Ω–∏—Ö**, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –≤ –≥–µ—Ç–µ—Ä–æ–≥–µ–Ω–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –∞–ª–µ –ø–æ—Ç—Ä–µ–±—É—î –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –Ω–∞ –∫–ª—é—á–æ–≤–∏—Ö –µ—Ç–∞–ø–∞—Ö ETL-–∫–æ–Ω–≤–µ—î—Ä–∞.

## –†–æ–±–æ—á–µ –∑–∞–≤–¥–∞–Ω–Ω—è

-   –í–∏–∫–æ–Ω–∞—Ç–∏ [–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è](#–≤–∞—Ä—ñ–∞–Ω—Ç–∏-—ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö-–∑–∞–≤–¥–∞–Ω—å)
-   –ö–æ–¥ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –Ω–∏–∂—á–µ:

```{r}

```

### –í–∞—Ä—ñ–∞–Ω—Ç–∏ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å {#–≤–∞—Ä—ñ–∞–Ω—Ç–∏-—ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö-–∑–∞–≤–¥–∞–Ω—å}

::: callout-note
*–í–∞—Ä—ñ–∞–Ω—Ç–∏ –≤–∏–±–∏—Ä–∞—é—Ç—å—Å—è –ø–æ –∫–æ–ª—É, –≤—ñ–¥—à—Ç–æ–≤—Ö—É—é—á–∏—Å—å –≤—ñ–¥ –Ω–æ–º–µ—Ä–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ —É —Å–ø–∏—Å–∫—É –≥—Ä—É–ø–∏.*
:::

## –í–∞—Ä—ñ–∞–Ω—Ç 1

### **–¢–µ–º–∞: –ê–Ω–∞–ª—ñ–∑ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–≤—ñ–∞–ø–µ—Ä–µ–≤–µ–∑–µ–Ω—å –∑–∞ 2014 —Ä—ñ–∫**

–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ **–æ–¥–∏–Ω –≤–µ–ª–∏–∫–∏–π —Ñ–∞–π–ª** `flights14.csv` (253 316 —Ä—è–¥–∫—ñ–≤), —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –ø—Ä–æ –≤—Å—ñ —Ä–µ–π—Å–∏, —â–æ –≤–∏–ª—ñ—Ç–∞–ª–∏ –∑ –∞–µ—Ä–æ–ø–æ—Ä—Ç—ñ–≤ –ù—å—é-–ô–æ—Ä–∫–∞ —É 2014 —Ä–æ—Ü—ñ (–¥–∞–Ω—ñ –∑ `nycflights14`). –¢–∞–∫–æ–∂ —É –≤–∞—Å —î **–¥–æ–≤—ñ–¥–Ω–∏–∫ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ–π** `airlines.csv` –∑ –ø–æ–≤–Ω–∏–º–∏ –Ω–∞–∑–≤–∞–º–∏ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫—ñ–≤.

–í–∞—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ **–ø–æ–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ–π** –≤–∏–∫–ª—é—á–Ω–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `data.table`.

------------------------------------------------------------------------

### üìå –ó–∞–≤–¥–∞–Ω–Ω—è

#### **–ï—Ç–∞–ø 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö**

-   –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ `flights14.csv` —á–µ—Ä–µ–∑ `fread()`.
-   –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ `airlines.csv` —á–µ—Ä–µ–∑ `fread()`.
-   –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –æ–±–∏–¥–≤–∞ –æ–±‚Äô—î–∫—Ç–∏ —î `data.table`.

```{r}
flights <- fread("data/flights14.csv")
print(class(flights))

airlines <- data.table(
  carrier = c("9E", "AA", "AS", "B6", "DL", "EV", "F9", "FL", "HA", "MQ", "OO", "UA", "US", "VX", "WN", "YV"),
  name = c("Endeavor Air Inc.", "American Airlines Inc.", "Alaska Airlines Inc.", "JetBlue Airways", "Delta Air Lines Inc.", "ExpressJet Airlines Inc.", "Frontier Airlines Inc.", "AirTran Airways Corp.", "Hawaiian Airlines Inc.", "Envoy Air", "SkyWest Airlines Inc.", "United Air Lines Inc.", "US Airways Inc.", "Virgin America", "Southwest Airlines Co.", "Mesa Airlines Inc.")
)
print("loaded airlines:")
print(class(airlines))
```

#### **–ï—Ç–∞–ø 2: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö**

-   –î–æ–¥–∞–π—Ç–µ —Å—Ç–æ–≤–ø–µ—Ü—å `total_delay = dep_delay + arr_delay` **–Ω–∞ –º—ñ—Å—Ü—ñ** —á–µ—Ä–µ–∑ `:=`.
-   –ó–∞–º—ñ–Ω—ñ—Ç—å –≤—ñ–¥‚Äô—î–º–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è `total_delay` –Ω–∞ 0 (—Ä–µ–π—Å –≤—á–∞—Å–Ω–æ).
-   –í–∏–¥–∞–ª—ñ—Ç—å —Å—Ç–æ–≤–ø—Ü—ñ `year`, `month`, `day` **–Ω–∞ –º—ñ—Å—Ü—ñ**.

```{r}
flights[, total_delay := dep_delay + arr_delay]

flights[total_delay < 0, total_delay := 0]

flights[, c("year", "month", "day") := NULL]

print("–ü–µ—Ä—à—ñ 5 —Ä—è–¥–∫—ñ–≤ –ø—ñ—Å–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏:")
print(head(flights))
```

#### **–ï—Ç–∞–ø 3: –ê–≥—Ä–µ–≥–∞—Ü—ñ—è –∑–∞ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—è–º–∏**

-   –û–±—á–∏—Å–ª—ñ—Ç—å –¥–ª—è –∫–æ–∂–Ω–æ—ó –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó (`carrier`):
    -   –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ–π—Å—ñ–≤ (`.N`),
    -   —Å–µ—Ä–µ–¥–Ω—î `total_delay`,
    -   —á–∞—Å—Ç–∫—É —Ä–µ–π—Å—ñ–≤ –∑ `total_delay > 60` —Ö–≤.
-   –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `by = carrier`.
-   –í—ñ–¥—Å–æ—Ä—Ç—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ —Å–ø–∞–¥–∞–Ω–Ω—è–º —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `keyby`.

```{r}
carrier_performance <- flights[, .(
  n_flights = .N,
  avg_total_delay = mean(total_delay, na.rm = TRUE),
  # piece of deleyed reises
  delay_fraction = sum(total_delay > 60, na.rm = TRUE) / .N
), by = carrier]

setorder(carrier_performance, -avg_total_delay)

print("Agregation:")
print(carrier_performance)
```

#### **–ï—Ç–∞–ø 4: –ó–ª–∏—Ç—Ç—è –∑ –¥–æ–≤—ñ–¥–Ω–∏–∫–æ–º**

-   –û–±‚Äô—î–¥–Ω–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑ `airlines` —á–µ—Ä–µ–∑ `on = "carrier"`, —â–æ–± –¥–æ–¥–∞—Ç–∏ –ø–æ–≤–Ω—É –Ω–∞–∑–≤—É –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—ó.
-   –ó–±–µ—Ä–µ–∂—ñ—Ç—å —É –∑–º—ñ–Ω–Ω—É `carrier_performance`.

```{r}
setkey(airlines, carrier)

carrier_performance[airlines, name := i.name, on = "carrier"]

print("result after join:")
print(carrier_performance)
```

#### **–ï—Ç–∞–ø 5: –ê–Ω–∞–ª—ñ–∑ –∑–∞ –∞–µ—Ä–æ–ø–æ—Ä—Ç–∞–º–∏**

-   –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∞–µ—Ä–æ–ø–æ—Ä—Ç—É –≤–∏–ª—å–æ—Ç—É (`origin`) –æ–±—á–∏—Å–ª—ñ—Ç—å:
    -   —Å–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É (`dep_delay`),
    -   –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ–π.
-   –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `.SD` —Ç–∞ `.SDcols`, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

```{r}
# avarage of of deley
airport_analysis <- flights[, .(
  avg_dep_delay = mean(dep_delay, na.rm = TRUE),
  # uniqueN() - fast data.table function of uniqe meanings
  n_unique_carriers = uniqueN(carrier)
), by = origin]

setorder(airport_analysis, -avg_dep_delay)

print("analize of airports (from the biggest deley):")
print(airport_analysis)
```

#### **–ï—Ç–∞–ø 6: –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)**

-   –ü–µ—Ä–µ—Ç–≤–æ—Ä—ñ—Ç—å `carrier_performance` –Ω–∞ `data.frame` —á–µ—Ä–µ–∑ `setDF()`.
-   –ü–æ–±—É–¥—É–π—Ç–µ –≥—Ä–∞—Ñ—ñ–∫ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –∑–∞ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—è–º–∏ (—á–µ—Ä–µ–∑ `ggplot2`).

```{r}
library(ggplot2)

# change carrier_performance to data.frame
setDF(carrier_performance)

# graphic build
ggplot(carrier_performance, 
       aes(x = reorder(name, avg_total_delay), 
           y = avg_total_delay, 
           fill = delay_fraction)) +
  geom_col(color = "black", alpha = 0.8) +
  # exchange coordinates
  coord_flip() +
  scale_fill_gradient(low = "#b2e067", high = "#e03b3b", name = "part of reises\n(deley > 60 min)") +
  labs(
    title = "average of deley (2014)",
    x = "airlaines",
    y = "avarage deley (min)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    axis.text.y = element_text(face = "bold")
  )
```

------------------------------------------------------------------------

### üí° –¢–µ—Ö–Ω—ñ—á–Ω—ñ –≤–∏–º–æ–≥–∏

-   –£–≤–µ—Å—å –∞–Ω–∞–ª—ñ–∑ –º–∞—î –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏–π **–≤–∏–∫–ª—é—á–Ω–æ —á–µ—Ä–µ–∑ `data.table`**.
-   **–ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `dplyr`, `tidyr`, `%>%`** –¥–ª—è –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ–π –∑ –¥–∞–Ω–∏–º–∏.
-   –£—Å—ñ —Ñ–∞–π–ª–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑ –ø–∞–ø–∫–∏ `data/`.
-   –ö–æ–Ω–≤–µ—î—Ä –º–∞—î –±—É—Ç–∏ **–≤—ñ–¥—Ç–≤–æ—Ä—é–≤–∞–Ω–∏–º** —Ç–∞ **–ø–∞–º‚Äô—è—Ç—å-–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º**.

```{=html}
<hr style="border: 1px solid #ddd; margin: 30px 0 10px 0;">
<footer style="text-align: center; font-size: 0.9em; color: #666; padding: 15px; background: #f9f9f9; border-top: 1px solid #eee; margin-top: 20px;">
  <p><strong>–í–∏–∫–æ–Ω–∞–≤(–ª–∞): –ú–∞—Ä–∏–Ω—á–µ–Ω–∫–æ –í–∞–ª–µ—Ä—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞</strong> | –ì—Ä—É–ø–∞: <strong>–ö–Ü-24-1–º</strong> | –í–∏–∫–ª–∞–¥–∞—á: –°–∏–¥–æ—Ä–µ–Ω–∫–æ –í.–ú.</p>
  <p>–ö—Ä–µ–º–µ–Ω—á—É—Ü—å–∫–∏–π –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç —ñ–º–µ–Ω—ñ –ú–∏—Ö–∞–π–ª–∞ –û—Å—Ç—Ä–æ–≥—Ä–∞–¥—Å—å–∫–æ–≥–æ &copy; 2025</p>
</footer>
```
