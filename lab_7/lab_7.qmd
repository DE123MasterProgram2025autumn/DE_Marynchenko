---
title: "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ7: –û—Å–Ω–æ–≤–∏ —Ä–æ–±–æ—Ç–∏ –∑ Apache Spark —É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ R (—á–µ—Ä–µ–∑ sparklyr)"
subtitle: "–Ü–Ω–∂–µ–Ω–µ—Ä—ñ—è –¥–∞–Ω–∏—Ö | –ö—Ä–ù–£ —ñ–º. –ú. –û—Å—Ç—Ä–æ–≥—Ä–∞–¥—Å—å–∫–æ–≥–æ"
author: "[–°–∏–¥–æ—Ä–µ–Ω–∫–æ –í–∞–ª–µ—Ä—ñ–π](https://www.linkedin.com/in/valeriy-sydorenko-6782279a/)"
date: last-modified
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 3
    toc-location: left
    sidebar: left
    collapse-level: 2
    code-fold: true
    code-overflow: wrap
    page-layout: full
editor: visual
execute:
  echo: true
  warning: false
  message: false
---

## –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–ù–∞–≤—á–∏—Ç–∏—Å—è –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä Apache Spark —Ç–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –±–∞–∑–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –≤–µ–ª–∏–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é R-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É `sparklyr`. –û—Å–≤–æ—ó—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ñ –µ—Ç–∞–ø–∏ —Ä–æ–±–æ—Ç–∏ –∑ Spark: –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö, –∞–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ `dplyr`-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–∞ –∫–æ—Ä–µ–∫—Ç–Ω–µ –≤—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è.

------------------------------------------------------------------------

## –©–æ –≤–∏ –±—É–¥–µ—Ç–µ –≤–º—ñ—Ç–∏ –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏?

‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ **Apache Spark –ª–æ–∫–∞–ª—å–Ω–æ** (–≤–∫–ª—é—á–∞—é—á–∏ Java 8 —Ç–∞ –ø–∞–∫–µ—Ç `sparklyr`).\
‚úÖ –ü—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Spark –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `spark_connect(master = "local")`.\
‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –≤ Spark —á–µ—Ä–µ–∑ `copy_to()` –∞–±–æ `spark_read_csv()`.\
‚úÖ –í–∏–∫–æ–Ω—É–≤–∞—Ç–∏ **–∞–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö —É —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–Ω–∞–π–æ–º–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É `dplyr` (`filter()`, `select()`, `group_by()`, `summarise()`).\
‚úÖ –û—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ R —á–µ—Ä–µ–∑ `collect()`, —Ä–æ–∑—É–º—ñ—é—á–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ü—ñ—î—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó.\
‚úÖ –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å —á–µ—Ä–µ–∑ **–≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Spark** (`spark_web()`): Jobs, Storage, Executors.\
‚úÖ –ö–æ—Ä–µ–∫—Ç–Ω–æ –≤—ñ–¥‚Äô—î–¥–Ω—É–≤–∞—Ç–∏—Å—è –≤—ñ–¥ –∫–ª–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ `spark_disconnect()`, —É–Ω–∏–∫–∞—Ç–∏ –≤–∏—Ç–æ–∫—É –ø–∞–º‚Äô—è—Ç—ñ.\
‚úÖ –†–æ–∑—É–º—ñ—Ç–∏, —è–∫ **–º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ ETL-–∫–æ–Ω–≤–µ—î—Ä–∏** –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö —É –º–∞–π–±—É—Ç–Ω—å–æ–º—É.

## –í—Å—Ç—É–ø

–£ —Å—É—á–∞—Å–Ω—ñ–π —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó –¥–∞–Ω–∏—Ö —á–∞—Å—Ç–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è, —è–∫—ñ **–≤–∏—Ö–æ–¥—è—Ç—å –∑–∞ –º–µ–∂—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –æ–¥–Ω—ñ—î—ó –º–∞—à–∏–Ω–∏**: –æ–±—Å—è–≥–∏ –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–≤–∏—â—É—é—Ç—å –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É –ø–∞–º‚Äô—è—Ç—å, –∞ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è ‚Äî –ø—Ä–∏–π–Ω—è—Ç–Ω—ñ —á–∞—Å–æ–≤—ñ –º–µ–∂—ñ. –£ —Ç–∞–∫–∏—Ö —É–º–æ–≤–∞—Ö –∫–ª–∞—Å–∏—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ `dplyr` –∞–±–æ –Ω–∞–≤—ñ—Ç—å `data.table`, —Ö–æ—á–∞ –π –¥—É–∂–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ, –≤–∂–µ –Ω–µ –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—ó –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ—Å—Ç—ñ.

–°–∞–º–µ –¥–ª—è —Ü—å–æ–≥–æ —ñ—Å–Ω—É—î **Apache Spark** ‚Äî —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∞ –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ **–≤–µ–ª–∏–∫–∏—Ö –æ–±—Å—è–≥—ñ–≤ –¥–∞–Ω–∏—Ö** (Big Data) —É –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ. Spark –¥–æ–∑–≤–æ–ª—è—î —Ä–æ–∑–ø–æ–¥—ñ–ª—è—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è –º—ñ–∂ –¥–µ—Å—è—Ç–∫–∞–º–∏, —Å–æ—Ç–Ω—è–º–∏ –∞–±–æ –Ω–∞–≤—ñ—Ç—å —Ç–∏—Å—è—á–∞–º–∏ –≤—É–∑–ª—ñ–≤, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ **–≤–∏—Å–æ–∫—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**, **–≤—ñ–¥–º–æ–≤–æ—Å—Ç—ñ–π–∫—ñ—Å—Ç—å** —Ç–∞ **–≥–Ω—É—á–∫—ñ—Å—Ç—å**.

–û–¥–Ω–∞–∫ Spark —Å–ø–æ—á–∞—Ç–∫—É –±—É–≤ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π –¥–ª—è –º–æ–≤ Scala —Ç–∞ Python. –©–æ–± –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ—Ç–∏ R, –∫–æ–º–∞–Ω–¥–∞ **Posit (–∫–æ–ª–∏—à–Ω—ñ–π RStudio)** —Å—Ç–≤–æ—Ä–∏–ª–∞ –ø–∞–∫–µ—Ç **`sparklyr`** ‚Äî –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π R-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ Apache Spark.

–ü–∞–∫–µ—Ç `sparklyr` –º–∞—î –∫—ñ–ª—å–∫–∞ –∫–ª—é—á–æ–≤–∏—Ö –ø–µ—Ä–µ–≤–∞–≥:

-   **–ó–Ω–∞–π–æ–º–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å**: –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–≤–∏—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `dplyr` (`filter()`, `select()`, `group_by()`, `summarise()`) –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏ —É Spark ‚Äî `sparklyr` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —ó—Ö –Ω–∞ **Spark SQL**-–∑–∞–ø–∏—Ç–∏.
-   **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ R-–µ–∫–æ—Å–∏—Å—Ç–µ–º–æ—é**: –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ `ggplot2` –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó, `DBI` –¥–ª—è –ø—Ä—è–º–∏—Ö SQL-–∑–∞–ø–∏—Ç—ñ–≤, `broom` –¥–ª—è –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è.
-   **–õ–æ–∫–∞–ª—å–Ω–∏–π —Ç–∞ –∫–ª–∞—Å—Ç–µ—Ä–Ω–∏–π —Ä–µ–∂–∏–º–∏**: –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ—á–∞—Ç–∏ –∑ **–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞** –Ω–∞ –≤–ª–∞—Å–Ω–æ–º—É –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ (—â–æ —ñ–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è), –∞ –ø–æ—Ç—ñ–º –ª–µ–≥–∫–æ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ —Ö–º–∞—Ä–Ω–∏—Ö –∞–±–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤ (YARN, Kubernetes, Databricks).
-   **–í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É**: Spark –Ω–∞–¥–∞—î –¥–µ—Ç–∞–ª—å–Ω–∏–π UI –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ, –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤ —Ç–æ—â–æ ‚Äî —Ü–µ –Ω–µ–∑–∞–º—ñ–Ω–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

–¶—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ –Ω–µ —î –ø–æ–≤–Ω–∏–º –∫—É—Ä—Å–æ–º –∑ Apache Spark. –ù–∞—Ç–æ–º—ñ—Å—Ç—å, –≤–æ–Ω–∞ –º–∞—î **–æ–¥–Ω—É —á—ñ—Ç–∫—É –º–µ—Ç—É**: –¥–∞—Ç–∏ –≤–∞–º **—à–≤–∏–¥–∫–∏–π, –ø—Ä–∞–∫—Ç–∏—á–Ω–∏–π —Å—Ç–∞—Ä—Ç** ‚Äî –≤—ñ–¥ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Spark –¥–æ –ø–µ—Ä—à–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –¥–∞–Ω–∏—Ö —É —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ. –í–∏ –Ω–∞–≤—á–∏—Ç–µ—Å—è:

-   –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ Spark –ª–æ–∫–∞–ª—å–Ω–æ,
-   –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ `spark_connect()`,
-   –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —É Spark (`copy_to()`, `spark_read_csv()`),
-   –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ `dplyr`-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å,
-   –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ R (`collect()`),
-   –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å,
-   –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥‚Äô—î–¥–Ω—É–≤–∞—Ç–∏—Å—è.

–¶—å–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ, —â–æ–± –≤–∏ –º–æ–≥–ª–∏ **–ø–æ—á–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Spark —É —Å–≤–æ—ó—Ö –ø—Ä–æ—î–∫—Ç–∞—Ö**, –∞ —Ç–∞–∫–æ–∂ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ —Å–≤–æ—ó ETL-–∫–æ–Ω–≤–µ—î—Ä–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö.

–î–∂–µ—Ä–µ–ª–æ–º –¥–ª—è —Ü—ñ—î—ó —Ä–æ–±–æ—Ç–∏ —Å–ª—É–≥—É—î –æ—Ñ—ñ—Ü—ñ–π–Ω–∞ –∫–Ω–∏–≥–∞ **¬´Mastering Spark with R¬ª** [@luraschi2019], –∞ —Å–∞–º–µ —ó—ó —Ä–æ–∑–¥—ñ–ª **¬´2. Getting Started¬ª**, —â–æ –≥–∞—Ä–∞–Ω—Ç—É—é—î –Ω–∞—É–∫–æ–≤—É —Ç–∞ —Ç–µ—Ö–Ω—ñ—á–Ω—É –¥–æ—Å—Ç–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –º–∞—Ç–µ—Ä—ñ–∞–ª—É.

## –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ –ø—Ä–æ Apache Spark

Apache Spark ‚Äî –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö, —â–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ [Hadoop](https://uk.wikipedia.org/wiki/Apache_Hadoop). –£ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ –∑ –Ω–∞–¥–∞–Ω–∏–º —É Hadoop –º–µ—Ö–∞–Ω—ñ–∑–º–æ–º [MapReduce](https://uk.wikipedia.org/wiki/MapReduce), Spark –∑–∞–±–µ–∑–ø–µ—á—É—î —É 100 —Ä–∞–∑—ñ–≤ –±—ñ–ª—å—à—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø—Ä–∏ –æ–±—Ä–æ–±–ª–µ–Ω–Ω—ñ –¥–∞–Ω–∏—Ö –≤ –ø–∞–º'—è—Ç—ñ –π 10 —Ä–∞–∑—ñ–≤ –ø—Ä–∏ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—ñ –¥–∞–Ω–∏—Ö –Ω–∞ –¥–∏—Å–∫–∞—Ö. –†—É—à—ñ–π –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è –Ω–∞ –≤—É–∑–ª–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ Hadoop —è–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Hadoop YARN, —Ç–∞–∫ —ñ —É –≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ. –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –æ–±—Ä–æ–±–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É —Å—Ö–æ–≤–∏—â–∞—Ö HDFS, HBaseÔªø\[–≤ —ñ–Ω—à–∏—Ö –º–æ–≤–∞—Ö\], Cassandra, HiveÔªø\[–≤ —ñ–Ω—à–∏—Ö –º–æ–≤–∞—Ö\] —Ç–∞ –±—É–¥—å-—è–∫–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ –≤–≤–µ–¥–µ–Ω–Ω—è Hadoop (InputFormat).

Spark –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è —è–∫ —É —Ç–∏–ø–æ–≤–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö –æ–±—Ä–æ–±–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö, —Å—Ö–æ–∂–∏—Ö –Ω–∞ MapReduce, —Ç–∞–∫ —ñ –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ –ø–æ—Ç–æ–∫–æ–≤–µ –æ–±—Ä–æ–±–ª–µ–Ω–Ω—è, SQL, —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –∑–∞–ø–∏—Ç–∏, —Ä—ñ—à–µ–Ω–Ω—è –∑–∞–¥–∞—á –º–∞—à–∏–Ω–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è —ñ —Ä–æ–±–æ—Ç–∞ –∑ –≥—Ä–∞—Ñ–∞–º–∏. –ü—Ä–æ–≥—Ä–∞–º–∏ –¥–ª—è –æ–±—Ä–æ–±–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –º–æ–∂—É—Ç—å —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏—Å—è –Ω–∞ –º–æ–≤–∞—Ö Scala, Java, Python —Ç–∞ R.

Spark –ø—ñ—Å–ª—è –ø–µ—Ä–µ–±—É–≤–∞–Ω–Ω—è –≤ —ñ–Ω–∫—É–±–∞—Ç–æ—Ä—ñ —Å—Ç–∞–≤ –ø–µ—Ä–≤–∏–Ω–Ω–∏–º –ø—Ä–æ—î–∫—Ç–æ–º Apache Software Foundation –≤—ñ–¥ –ª—é—Ç–æ–≥–æ 2014. [@wikipedia_apache_spark_uk]

Apache Spark ‚Äî —Ü–µ **—Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∞ –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è**, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ **–≤–µ–ª–∏–∫–∏—Ö –æ–±—Å—è–≥—ñ–≤ –¥–∞–Ω–∏—Ö** (Big Data) —É –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ. –í—ñ–Ω –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –¥–∞–Ω–∏–º–∏ **—É –ø–∞–º‚Äô—è—Ç—ñ**, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –∑–Ω–∞—á–Ω–æ —à–≤–∏–¥—à–∏–º –∑–∞ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Hadoop MapReduce).

Spark –ø—ñ–¥—Ç—Ä–∏–º—É—î:\
- **–ø–∞–∫–µ—Ç–Ω—É –æ–±—Ä–æ–±–∫—É** (batch processing),\
- **–ø–æ—Ç–æ–∫–æ–≤—É –æ–±—Ä–æ–±–∫—É** (streaming),\
- **–º–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è** (MLlib),\
- **SQL-–∑–∞–ø–∏—Ç–∏** (Spark SQL).

–£—è–≤—ñ—Ç—å, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ **10 000 —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —Ç–µ–∫—Å—Ç—É** —ñ –∑–Ω–∞–π—Ç–∏ –≤—Å—ñ —Å–ª–æ–≤–∞ ¬´–¥–∞–Ω—ñ¬ª. –Ø–∫—â–æ –≤–∏ –ø—Ä–∞—Ü—é—î—Ç–µ **—Å–∞–º–æ—Ç—É–∂–∫–∏** (—è–∫ —É –∑–≤–∏—á–∞–π–Ω–æ–º—É R), –≤–∏ –ø–µ—Ä–µ–≥–ª—è–¥–∞—î—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø–æ —á–µ—Ä–∑—ñ ‚Äî —Ü–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –≥–æ–¥–∏–Ω–∏. –ê–ª–µ —è–∫—â–æ —É –≤–∞—Å —î **10 –ø–æ–º—ñ—á–Ω–∏–∫—ñ–≤**, —ñ –≤–∏ —Ä–æ–∑–¥–∞—î—Ç–µ –∫–æ–∂–Ω–æ–º—É –ø–æ 1000 —Å—Ç–æ—Ä—ñ–Ω–æ–∫ ‚Äî —Ä–æ–±–æ—Ç–∞ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞ **–≤ 10 —Ä–∞–∑—ñ–≤ —à–≤–∏–¥—à–µ**.

**Apache Spark ‚Äî —Ü–µ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä**, —è–∫–∏–π:\
- —Ä–æ–∑–ø–æ–¥—ñ–ª—è—î –∑–∞–≤–¥–∞–Ω–Ω—è –º—ñ–∂ –±–∞–≥–∞—Ç—å–º–∞ ¬´–ø–æ–º—ñ—á–Ω–∏–∫–∞–º–∏¬ª (–≤—É–∑–ª–∞–º–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞)\
- –∫–æ–æ—Ä–¥–∏–Ω—É—î —ó—Ö–Ω—é —Ä–æ–±–æ—Ç—É\
- –∑–±–∏—Ä–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ —î–¥–∏–Ω–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å.

–£ –º–µ–∂–∞—Ö –∫—É—Ä—Å—É ¬´–Ü–Ω–∂–µ–Ω–µ—Ä—ñ—è –¥–∞–Ω–∏—Ö¬ª –º–∏ —Ñ–æ–∫—É—Å—É—î–º–æ—Å—å –Ω–∞ **–ø–∞–∫–µ—Ç–Ω—ñ–π –æ–±—Ä–æ–±—Ü—ñ –¥–∞–Ω–∏—Ö** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É `sparklyr`**, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ Spark —á–µ—Ä–µ–∑ –∑–Ω–∞–π–æ–º–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `dplyr`.

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Spark –ª–æ–∫–∞–ª—å–Ω–æ

–ü–µ—Ä—à –Ω—ñ–∂ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ Apache Spark —É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ R, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤. –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ –ø—Ä–∞—Ü—é—î–º–æ –≤ **–ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ** (–Ω–∞ –≤–ª–∞—Å–Ω–æ–º—É –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ), —É—Å–µ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç `sparklyr`.

#### üîß –ö—Ä–æ–∫ 1: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Java 8

Apache Spark –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ –º–æ–≤—ñ **Scala**, —è–∫–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —É **Java Virtual Machine (JVM)**. –¢–æ–º—É **Java 8** —î –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ—é –≤–∏–º–æ–≥–æ—é.

-   **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é Java** —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –∞–±–æ —á–µ—Ä–µ–∑ R:

    ``` r
    system("java -version")
    ```

-   –Ø–∫—â–æ Java –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∞–±–æ –≤–µ—Ä—Å—ñ—è –Ω–æ–≤—ñ—à–∞ –∑–∞ 8 (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Java 11, 17), **–≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Java 8**:

    -   Windows / macOS: –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∑ [Adoptium (Eclipse Temurin 8)](https://adoptium.net/temurin/releases/?version=8)\

    -   Linux (Ubuntu/Debian):

        ``` bash
        sudo apt install openjdk-8-jdk
        ```

-   –ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ R ¬´–±–∞—á–∏—Ç—å¬ª Java 8:

    ``` r
    Sys.setenv(JAVA_HOME = "—à–ª—è—Ö/–¥–æ/java8")  # –ª–∏—à–µ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
    ```

> üí° **–£–≤–∞–≥–∞**: Spark **–æ—Ñ—ñ—Ü—ñ–π–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î –ª–∏—à–µ Java 8**. –ù–æ–≤—ñ—à—ñ –≤–µ—Ä—Å—ñ—ó –º–æ–∂—É—Ç—å –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø–æ–º–∏–ª–æ–∫.

#### üîß –ö—Ä–æ–∫ 2: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–∫–µ—Ç–∞ `sparklyr`

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ø–∞–∫–µ—Ç —ñ–∑ CRAN:

```{r}
# install.packages("sparklyr")
```

–î–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ–π (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó) –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏—Ü—å–∫—É –≤–µ—Ä—Å—ñ—é:

```{r}
# install.packages("devtools")
# devtools::install_github("sparklyr/sparklyr")
```

#### üîß –ö—Ä–æ–∫ 3: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Spark

–ü–∞–∫–µ—Ç `sparklyr` –¥–æ–∑–≤–æ–ª—è—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Spark:

```{r}
library(sparklyr)

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é —Å—É–º—ñ—Å–Ω—É –≤–µ—Ä—Å—ñ—é Spark
# spark_install(version = "3.3.2")  # —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è
```

> üí° –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º Spark –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è —É:\
> - Windows: `%LOCALAPPDATA%\spark`\
> - macOS / Linux: `~/spark`

#### üîß –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ Spark –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:

```{r}
spark_installed_versions()
# –ü–æ–≤–∏–Ω–µ–Ω –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ —Å–ø–∏—Å–æ–∫, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
#   spark hadoop                              dir
# 1 3.3.2    3.3 /Users/valeriy/spark/spark-3.3.2-bin-hadoop3.3
```

#### üîß –ö—Ä–æ–∫ 5: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ –≤–ª–∞—Å–Ω—É –ø–∞–ø–∫—É –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:

```{r}
options(spark.install.dir = "C:/my_spark")  # Windows
# options(spark.install.dir = "~/custom_spark")  # macOS/Linux
```

## –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Spark

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Spark —Ç–∞ Java 8, –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º —î **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è** –º—ñ–∂ R —ñ –ª–æ–∫–∞–ª—å–Ω–∏–º –∫–ª–∞—Å—Ç–µ—Ä–æ–º Spark. –¶–µ —Ä–æ–±–∏—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó `spark_connect()` –∑ –ø–∞–∫–µ—Ç–∞ `sparklyr`.

#### üîå –ö—Ä–æ–∫ 1: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

``` r
library(sparklyr)

# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
sc <- spark_connect(master = "local")
```

-   **`master = "local"`** ‚Äî –≤–∫–∞–∑—É—î, —â–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ **–ª–æ–∫–∞–ª—å–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä** (–≤—Å—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –Ω–∞ –≤–∞—à—ñ–π –º–∞—à–∏–Ω—ñ).

-   **`sc`** ‚Äî –æ–±‚Äô—î–∫—Ç –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è (—Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –≤—ñ–¥ *Spark Connection*), —è–∫–∏–π –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö –∑ Spark.

> üí° **–ü–æ—Ä–∞–¥–∞**: –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ —è–¥–µ—Ä, –º–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:\
> `spark_connect(master = "local[4]")` ‚Äî –¥–ª—è 4 —è–¥–µ—Ä.

#### üîç –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –≤—Å–µ –ø—Ä–∞—Ü—é—î:

``` r
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è
print(sc)

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–µ—Ä—Å—ñ—é Spark
spark_version(sc)
```

–Ø–∫—â–æ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–µ—Ä—Å—ñ—é Spark, —à–ª—è—Ö –¥–æ `SPARK_HOME` —Ç–∞ —ñ–Ω—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.

#### ‚ö†Ô∏è –ü–æ—à–∏—Ä–µ–Ω—ñ –ø–æ–º–∏–ª–∫–∏

-   **`Java not found`** ‚Äî –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ **Java 8** —ñ R ¬´–±–∞—á–∏—Ç—å¬ª —ó—ó.

-   **`Cannot find spark-submit`** ‚Äî –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ Spark –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ `spark_install()` —ñ —à–ª—è—Ö –¥–æ –Ω—å–æ–≥–æ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π.

#### üîó –©–æ —Ä–æ–±–∏—Ç–∏ –¥–∞–ª—ñ?

–ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤–∏ –º–æ–∂–µ—Ç–µ:\
- –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —É Spark\
- –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ `dplyr`\
- –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

–¶–µ –±—É–¥–µ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–æ –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∞—Ö.

## –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É Spark

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Spark, –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º —î **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö** —É —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ. –ü–∞–∫–µ—Ç `sparklyr` –Ω–∞–¥–∞—î –∫—ñ–ª—å–∫–∞ —Å–ø–æ—Å–æ–±—ñ–≤ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ ‚Äî –≤—ñ–¥ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö `data.frame` –¥–æ —á–∏—Ç–∞–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Ñ–∞–π–ª—ñ–≤ (CSV, JSON, Parquet —Ç–æ—â–æ).

#### üîπ –ö—Ä–æ–∫ 1: –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ `copy_to()`

–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–± ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤–∂–µ –Ω–∞—è–≤–Ω–∏–π `data.frame` –∑ R —É Spark:

``` r
library(sparklyr)
library(dplyr)
library(nycflights13)  # –ø—Ä–∏–∫–ª–∞–¥ –¥–∞–Ω–∏—Ö

# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (—è–∫—â–æ —â–µ –Ω–µ –∑—Ä–æ–±–ª–µ–Ω–æ)
sc <- spark_connect(master = "local")

# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —É Spark
flights_tbl <- copy_to(sc, nycflights13::flights, "flights", overwrite = TRUE)
```

-   **`sc`** ‚Äî –æ–±‚Äô—î–∫—Ç –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è.\
-   **`nycflights13::flights`** ‚Äî –ª–æ–∫–∞–ª—å–Ω–∏–π `data.frame`.\
-   **`"flights"`** ‚Äî –Ω–∞–∑–≤–∞ —Ç–∞–±–ª–∏—Ü—ñ –≤ Spark.
-   **`overwrite = TRUE`** ‚Äî –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ —ñ—Å–Ω—É—é—á—É —Ç–∞–±–ª–∏—Ü—é.

> üí° –¶–µ–π –º–µ—Ç–æ–¥ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è **–Ω–µ–≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö** (–¥–æ –∫—ñ–ª—å–∫–æ—Ö –º—ñ–ª—å–π–æ–Ω—ñ–≤ —Ä—è–¥–∫—ñ–≤). –î–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä—è–º–∏–π —ñ–º–ø–æ—Ä—Ç –∑ —Ñ–∞–π–ª—ñ–≤.

#### üîπ –ö—Ä–æ–∫ 2: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Ñ–∞–π–ª—ñ–≤

`sparklyr` –ø—ñ–¥—Ç—Ä–∏–º—É—î —á–∏—Ç–∞–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó `spark_read_*`:

``` r
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è CSV
sales_tbl <- spark_read_csv(sc, "sales", path = "data/sales_2024.csv")

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è JSON
logs_tbl <- spark_read_json(sc, "logs", path = "data/app_logs.json")

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Parquet (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö)
users_tbl <- spark_read_parquet(sc, "users", path = "data/users.parquet")
```

-   **`"sales"`**, **`"logs"`**, **`"users"`** ‚Äî –Ω–∞–∑–≤–∏ —Ç–∞–±–ª–∏—Ü—å —É Spark.\
-   **`path`** ‚Äî —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É (–ª–æ–∫–∞–ª—å–Ω–∏–π –∞–±–æ `hdfs://`, `s3://` —Ç–æ—â–æ).

> üí° **Parquet** ‚Äî —Å—Ç–æ–≤–ø—Ü–µ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç, –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤. –í—ñ–Ω **—à–≤–∏–¥—à–∏–π —ñ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–π –∑–∞ CSV** –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö.

#### üîπ –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö –±–µ–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ R

–ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞ –∑–º—ñ—Å—Ç** —Ç–∞–±–ª–∏—Ü—ñ –±–µ–∑ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ R:

``` r
# –ü–µ—Ä–µ–≥–ª—è–¥ –ø–µ—Ä—à–∏—Ö 10 —Ä—è–¥–∫—ñ–≤
head(flights_tbl)

# –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ (—Å—Ç–æ–≤–ø—Ü—ñ —Ç–∞ —Ç–∏–ø–∏)
glimpse(flights_tbl)

# –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤
count(flights_tbl)
```

–¶—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è **—É Spark**, —Ç–æ–º—É –Ω–µ —Å–ø–æ–∂–∏–≤–∞—é—Ç—å –ø–∞–º‚Äô—è—Ç—å R.

#### üîπ –ü–æ—à–∏—Ä–µ–Ω—ñ –ø–æ–º–∏–ª–∫–∏

-   **`File not found`** ‚Äî –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —ñ —Ñ–∞–π–ª —ñ—Å–Ω—É—î.\
-   **`Unsupported type`** ‚Äî Spark –º–æ–∂–µ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ —Ç–∏–ø–∏ –¥–∞–Ω–∏—Ö R (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `POSIXlt`). –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `POSIXct`.

------------------------------------------------------------------------

‚úÖ –ü—ñ—Å–ª—è —Ü–∏—Ö –∫—Ä–æ–∫—ñ–≤ –≤–∞—à—ñ –¥–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ –¥–æ –∞–Ω–∞–ª—ñ–∑—É —É —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ ‚Äî –ø—Ä–æ —Ü–µ –π—Ç–∏–º–µ—Ç—å—Å—è –¥–∞–ª—ñ.

## –ê–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ dplyr-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û–¥–Ω—ñ—î—é –∑ –Ω–∞–π–±—ñ–ª—å—à–∏—Ö –ø–µ—Ä–µ–≤–∞–≥ `sparklyr` —î —Ç–µ, —â–æ –≤—ñ–Ω **–ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω—Ç–µ–≥—Ä—É—î—Ç—å—Å—è –∑ `dplyr`**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–Ω–∞–π–æ–º–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `filter()`, `select()`, `mutate()`, `group_by()`, `summarise()` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞–Ω–∏–º–∏ —É Spark ‚Äî –∞ `sparklyr` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å –≤–∞—à—ñ –∑–∞–ø–∏—Ç–∏ –Ω–∞ **Spark SQL** –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º.

–¶–µ –¥–æ–∑–≤–æ–ª—è—î:\
- –ø–∏—Å–∞—Ç–∏ **—á–∏—Ç–∞–±–µ–ª—å–Ω–∏–π, –≤–∏—Ä–∞–∑–Ω–∏–π –∫–æ–¥**\
- **—É—Å–∫–ª–∞–¥–Ω—é–≤–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –ø–æ—Å—Ç—É–ø–æ–≤–æ** (–ª–∞–Ω—Ü—é–∂–∫–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π)\
- **—É—Å—É–≤–∞—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å –≤–∏–≤—á–µ–Ω–Ω—è SQL** –¥–ª—è –±–∞–∑–æ–≤–∏—Ö –∑–∞–≤–¥–∞–Ω—å.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥ 1: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç–∞ –≤–∏–±—ñ—Ä–∫–∞

``` r
library(sparklyr)
library(dplyr)

# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (—è–∫—â–æ —â–µ –Ω–µ –∑—Ä–æ–±–ª–µ–Ω–æ)
sc <- spark_connect(master = "local")

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (—è–∫ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ)
flights_tbl <- copy_to(sc, nycflights13::flights, "flights", overwrite = TRUE)

# –í–∏–±—Ä–∞—Ç–∏ —Ä–µ–π—Å–∏ –∑ JFK, –¥–µ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É > 60 —Ö–≤
delayed_flights <- flights_tbl %>%
  filter(origin == "JFK", dep_delay > 60) %>%
  select(flight, dep_delay, arr_delay, carrier)
```

–¶–µ–π –∫–æ–¥ **–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –≤ R** ‚Äî –≤—ñ–Ω –ª–∏—à–µ —Å—Ç–≤–æ—Ä—é—î **–ø–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è** —É Spark.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥ 2: –ê–≥—Ä–µ–≥–∞—Ü—ñ—è –∑–∞ –≥—Ä—É–ø–∞–º–∏

``` r
# –°–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É –∑–∞ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—î—é
avg_delay_by_carrier <- flights_tbl %>%
  group_by(carrier) %>%
  summarise(avg_dep_delay = mean(dep_delay, na.rm = TRUE))
```

> üí° **–í–∞–∂–ª–∏–≤–æ**: –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è **—É Spark**, —Ç–æ–º—É –Ω–∞–≤—ñ—Ç—å –Ω–∞ –º—ñ–ª—å–π–æ–Ω–∞—Ö —Ä—è–¥–∫—ñ–≤ –≤–æ–Ω–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è —à–≤–∏–¥–∫–∏–º–∏.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥ 3: –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è

``` r
# –¢–æ–ø-5 –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ–π –∑ –Ω–∞–π–±—ñ–ª—å—à–∏–º —Å–µ—Ä–µ–¥–Ω—ñ–º –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è–º
top_delayed <- avg_delay_by_carrier %>%
  arrange(desc(avg_dep_delay)) %>%
  head(5)
```

#### üîπ –ö–æ–ª–∏ –¥–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –≤ R?

–ü–æ–∫–∏ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ `dplyr`-–æ–ø–µ—Ä–∞—Ü—ñ—ó, –¥–∞–Ω—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è —É Spark. –©–æ–± **–æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É R**, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `collect()`:

``` r
result_df <- top_delayed %>% collect()
class(result_df)  # "data.frame"
```

> ‚ö†Ô∏è **–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è**: `collect()` –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î **–≤—Å—ñ –¥–∞–Ω—ñ** —É –ø–∞–º‚Äô—è—Ç—å R. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –π–æ–≥–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ç–∞–±–ª–∏—Ü—å!

#### üîπ –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

`sparklyr` –ø—ñ–¥—Ç—Ä–∏–º—É—î –±—ñ–ª—å—à—ñ—Å—Ç—å —Ñ—É–Ω–∫—Ü—ñ–π `dplyr`, –∞ —Ç–∞–∫–æ–∂:\
- –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (`log()`, `sqrt()`, `abs()`)\
- –ª–æ–≥—ñ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó (`if_else()`, `case_when()`)\
- —Ä–æ–±–æ—Ç—É –∑ –¥–∞—Ç–∞–º–∏ (`year()`, `month()`, `date()`).

–ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ ‚Äî —É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó: `?sparklyr::dplyr`.

## –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É R

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑—É —É Spark, –Ω–∞—Å—Ç–∞—î —á–∞—Å **–æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ R** –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–±—Ä–æ–±–∫–∏, –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –∞–±–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è. –¶–µ —Ä–æ–±–∏—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó `collect()`.

#### üîπ –Ø–∫ –ø—Ä–∞—Ü—é—î `collect()`?

–§—É–Ω–∫—Ü—ñ—è `collect()` **–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ Spark —É –ø–∞–º‚Äô—è—Ç—å R** —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —ó—Ö –Ω–∞ –∑–≤–∏—á–∞–π–Ω–∏–π `data.frame`:

``` r
# –ü—Ä–∏–∫–ª–∞–¥ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É
avg_delay_by_carrier <- flights_tbl %>%
  group_by(carrier) %>%
  summarise(avg_dep_delay = mean(dep_delay, na.rm = TRUE))

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ R
result_df <- avg_delay_by_carrier %>% collect()
class(result_df)  # "data.frame"
```

> ‚ö†Ô∏è **–£–≤–∞–≥–∞**: `collect()` –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î **–≤—Å—ñ –¥–∞–Ω—ñ** —É –ø–∞–º‚Äô—è—Ç—å R. –Ø–∫—â–æ —Ç–∞–±–ª–∏—Ü—è –≤–µ–ª–∏–∫–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –º—ñ–ª—å–π–æ–Ω–∏ —Ä—è–¥–∫—ñ–≤), —Ü–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ **–ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ** –∞–±–æ –∑–∞–≤–∏—Å–∞–Ω–Ω—è R.

#### üîπ –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `collect()`?

-   –î–ª—è **—Ñ—ñ–Ω–∞–ª—å–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏, —Ç–æ–ø-10 –∑–Ω–∞—á–µ–Ω—å).\
-   –î–ª—è **–≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó** (—á–µ—Ä–µ–∑ `ggplot2`, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –∑ `data.frame`).\
-   –î–ª—è **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É —Ñ–∞–π–ª** (CSV, Excel —Ç–æ—â–æ).

#### üîπ –©–æ —Ä–æ–±–∏—Ç–∏, —è–∫—â–æ –¥–∞–Ω—ñ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫—ñ?

-   **–ê–≥—Ä–µ–≥—É–π—Ç–µ –¥–∞–Ω—ñ —É Spark** –ø–µ—Ä–µ–¥ `collect()` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `summarise()`, `count()`).\

-   –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `head()` –∞–±–æ `sample_n()` —É Spark –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—ñ–¥–≤–∏–±—ñ—Ä–∫–∏:

    ``` r
    sample_df <- flights_tbl %>% 
        sample_n(1000) %>% 
        collect()   
    ```

-   –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–æ–Ω—É–π—Ç–µ `collect()` –Ω–∞ –Ω–µ—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ –∑ –º—ñ–ª—å–π–æ–Ω–∞–º–∏ —Ä—è–¥–∫—ñ–≤!

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

``` r
library(ggplot2)

# –ê–≥—Ä–µ–≥–∞—Ü—ñ—è —É Spark
top_carriers <- flights_tbl %>%
  group_by(carrier) %>%
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE)) %>%
  arrange(desc(avg_delay)) %>%
  head(5) %>%
  collect()  # –ª–∏—à–µ 5 —Ä—è–¥–∫—ñ–≤ ‚Äî –±–µ–∑–ø–µ—á–Ω–æ!

# –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ R
ggplot(top_carriers, aes(x = reorder(carrier, avg_delay), y = avg_delay)) +
  geom_col() +
  coord_flip() +
  labs(title = "–¢–æ–ø-5 –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ–π –∑–∞ —Å–µ—Ä–µ–¥–Ω—ñ–º –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è–º")
```

------------------------------------------------------------------------

‚úÖ –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –∫—Ä–æ–∫—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ **—ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ Spark —É –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–π workflow —É R**, –≤–∫–ª—é—á–∞—é—á–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é, –∑–≤—ñ—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è.

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Spark

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É –æ–±—á–∏—Å–ª–µ–Ω—å —É Spark, –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏, –≤–∞–∂–ª–∏–≤–æ **–≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Å—Ç–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º‚Äô—è—Ç—ñ —Ç–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤. –î–ª—è —Ü—å–æ–≥–æ Spark –Ω–∞–¥–∞—î **–≤–±—É–¥–æ–≤–∞–Ω–∏–π –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å**, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —Ä–∞–∑–æ–º —ñ–∑ –ª–æ–∫–∞–ª—å–Ω–∏–º –∫–ª–∞—Å—Ç–µ—Ä–æ–º.

#### üîπ –Ø–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å?

–ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Spark (`sc <- spark_connect(...)`), –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

``` r
spark_web(sc)
```

–¶—è –∫–æ–º–∞–Ω–¥–∞ –≤—ñ–¥–∫—Ä–∏—î –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ (–∞–±–æ –≤–∏–≤–µ–¥–µ URL —É –∫–æ–Ω—Å–æ–ª—å, —è–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ `--no-browse`).

> üí° **–ü–æ—Ä–∞–¥–∞**: –Ø–∫—â–æ –≤–∏ –∫–æ–º–ø—ñ–ª—é—î—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑\
> `quarto preview lab_7.qmd --no-browse`, –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø—ñ—é–π—Ç–µ URL –∑ –∫–æ–Ω—Å–æ–ª—ñ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –π–æ–≥–æ –≤—Ä—É—á–Ω—É.

#### üîπ –û—Å–Ω–æ–≤–Ω—ñ –≤–∫–ª–∞–¥–∫–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

1.  **Jobs** ‚Äî –ø–æ–∫–∞–∑—É—î –∞–∫—Ç–∏–≤–Ω—ñ —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `collect()`, `filter()`, `summarise()`).
2.  **Stages** ‚Äî –¥–µ—Ç–∞–ª—ñ–∑—É—î –µ—Ç–∞–ø–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è.
3.  **Storage** ‚Äî –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –¥–∞–Ω—ñ, –∫–µ—à–æ–≤–∞–Ω—ñ –≤ –ø–∞–º‚Äô—è—Ç—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–∞–±–ª–∏—Ü—ñ, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —á–µ—Ä–µ–∑ `copy_to()`).
4.  **Executors** ‚Äî –ø–æ–∫–∞–∑—É—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ (–ø–∞–º‚Äô—è—Ç—å, —è–¥—Ä–∞) –∫–æ–∂–Ω–∏–º –≤–∏–∫–æ–Ω–∞–≤—Ü–µ–º.
5.  **Environment** ‚Äî –ø–µ—Ä–µ–ª—ñ–∫ —É—Å—ñ—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å Spark (–∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏).

#### üîπ –ù–∞–≤—ñ—â–æ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ?

-   **–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–∏—Å–∞–Ω—å**: —è–∫—â–æ –∞–Ω–∞–ª—ñ–∑ ¬´–∑–∞–≤–∏—Å¬ª, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ, –Ω–∞ —è–∫–æ–º—É –µ—Ç–∞–ø—ñ –∑—É–ø–∏–Ω–∏–≤—Å—è –ø—Ä–æ—Ü–µ—Å.\
-   **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–∞–º‚Äô—è—Ç—ñ**: –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —Å–∫—ñ–ª—å–∫–∏ –¥–∞–Ω–∏—Ö –∫–µ—à–æ–≤–∞–Ω–æ, —ñ —á–∏ –Ω–µ –ø–µ—Ä–µ–≤–∏—â—É—î—Ç–µ –ª—ñ–º—ñ—Ç.\
-   **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö**: –ø—ñ—Å–ª—è `copy_to()` –∞–±–æ `spark_read_csv()` —Ç–∞–±–ª–∏—Ü—è –∑‚Äô—è–≤–∏—Ç—å—Å—è —É –≤–∫–ª–∞–¥—Ü—ñ **Storage**.

#### üîπ –ü—Ä–∏–∫–ª–∞–¥: –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

``` r
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
flights_tbl <- copy_to(sc, nycflights13::flights, "flights")

# –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
spark_web(sc)
```

–£ –≤–∫–ª–∞–¥—Ü—ñ **Storage** –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—é `flights`, –∫–µ—à–æ–≤–∞–Ω—É –≤ –ø–∞–º‚Äô—è—Ç—ñ, –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ —Ä–æ–∑–º—ñ—Ä (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **253 316 —Ä—è–¥–∫—ñ–≤**, **\~15 MB**).

## –í—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è —Ç–∞ –æ—á–∏—â–µ–Ω–Ω—è

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –∑ Spark **–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –≤—ñ–¥‚Äô—î–¥–Ω–∞–π—Ç–µ—Å—è –≤—ñ–¥ –∫–ª–∞—Å—Ç–µ—Ä–∞**, —â–æ–± –∑–≤—ñ–ª—å–Ω–∏—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ (–ø–∞–º‚Äô—è—Ç—å, –ø—Ä–æ—Ü–µ—Å–∏) —Ç–∞ —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏—Ç–æ–∫—É –ø–∞–º‚Äô—è—Ç—ñ, –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.

#### üîπ –Ø–∫ –≤—ñ–¥‚Äô—î–¥–Ω–∞—Ç–∏—Å—è?

``` r
# –í—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è –≤—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è
spark_disconnect(sc)
```

–¶—è –∫–æ–º–∞–Ω–¥–∞:\
- –∑—É–ø–∏–Ω—è—î Spark-–¥–æ–¥–∞—Ç–æ–∫\
- –∑–≤—ñ–ª—å–Ω—è—î –≤—Å—é –≤–∏–¥—ñ–ª–µ–Ω—É –ø–∞–º‚Äô—è—Ç—å\
- –∑–∞–∫—Ä–∏–≤–∞—î –ø—Ä–æ—Ü–µ—Å–∏ JVM.

#### üîπ –©–æ —Ä–æ–±–∏—Ç–∏, —è–∫—â–æ –æ–±‚Äô—î–∫—Ç `sc` –≤—Ç—Ä–∞—á–µ–Ω–æ?

–Ø–∫—â–æ –≤–∏ –≤–∏–ø–∞–¥–∫–æ–≤–æ –≤–∏–¥–∞–ª–∏–ª–∏ `sc` –∞–±–æ –º–∞—î—Ç–µ –∫—ñ–ª—å–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω—å, –º–æ–∂–Ω–∞ –≤—ñ–¥‚Äô—î–¥–Ω–∞—Ç–∏—Å—è –≤—ñ–¥ **—É—Å—ñ—Ö –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Å—ñ–π**:

``` r
spark_disconnect_all()
```

#### üîπ –ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ?

-   **–õ–æ–∫–∞–ª—å–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä**: –∫–æ–∂–Ω–µ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑–∞–π–º–∞—î **2 –ì–ë –ø–∞–º‚Äô—è—Ç—ñ** –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –Ø–∫—â–æ –Ω–µ –≤—ñ–¥‚Äô—î–¥–Ω–∞—Ç–∏—Å—è, –ø—Ä–æ—Ü–µ—Å–∏ –∑–∞–ª–∏—à–∞—Ç—å—Å—è —É —Ñ–æ–Ω—ñ, —ñ –ø–∞–º‚Äô—è—Ç—å –Ω–µ –∑–≤—ñ–ª—å–Ω–∏—Ç—å—Å—è.\
-   **–°–ø—ñ–ª—å–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∏**: –≤–∏ –º–æ–∂–µ—Ç–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ –¥–ª—è —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.\
-   **Quarto/RStudio**: –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ –±–µ–∑ –≤—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –∑‚Äô—î–¥–Ω–∞–Ω—å.

#### üîπ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è

–•–æ—á–∞ –≤–∏—Ö—ñ–¥ –∑ R –∞–±–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Å—ñ—ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à—É—î –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è, **–Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø–æ–∫–ª–∞–¥–∞–π—Ç–µ—Å—è –Ω–∞ —Ü–µ** —É production-–∫–æ–¥—ñ. –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —è–≤–Ω–µ `spark_disconnect()`.

------------------------------------------------------------------------

‚úÖ –¶–µ–π –∫—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—É—î **–ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª —Ä–æ–±–æ—Ç–∏ –∑ Apache Spark**:\
1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è ‚Üí\
2. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è ‚Üí\
3. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö ‚Üí\
4. –ê–Ω–∞–ª—ñ–∑ ‚Üí\
5. –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ ‚Üí\
6. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ ‚Üí\
7. **–í—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è**.

–¶–µ —Ä–æ–±–∏—Ç—å –≤–∞—à –∫–æ–¥ **–Ω–∞–¥—ñ–π–Ω–∏–º, —á–∏—Å—Ç–∏–º —ñ –≥–æ—Ç–æ–≤–∏–º –¥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è**.

## –†–æ–±–æ—á–µ –∑–∞–≤–¥–∞–Ω–Ω—è

-   –í–∏–∫–æ–Ω–∞—Ç–∏ [–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è.](#–≤–∞—Ä—ñ–∞–Ω—Ç–∏-—ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö-–∑–∞–≤–¥–∞–Ω—å)
-   –ö–æ–¥ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –Ω–∏–∂—á–µ:

```{r}
# –¢—É—Ç –º–∞—î –±—É—Ç–∏ –≤–∞—à –∫–æ–¥
```

### –í–∞—Ä—ñ–∞–Ω—Ç–∏ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å {#–≤–∞—Ä—ñ–∞–Ω—Ç–∏-—ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö-–∑–∞–≤–¥–∞–Ω—å}

::: callout-note
*–í–∞—Ä—ñ–∞–Ω—Ç–∏ –≤–∏–±–∏—Ä–∞—é—Ç—å—Å—è –ø–æ –∫–æ–ª—É, –≤—ñ–¥—à—Ç–æ–≤—Ö—É—é—á–∏—Å—å –≤—ñ–¥ –Ω–æ–º–µ—Ä–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ —É —Å–ø–∏—Å–∫—É –≥—Ä—É–ø–∏.*
:::

## –í–∞—Ä—ñ–∞–Ω—Ç 1

### –¢–µ–º–∞: –ê–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö –ø—Ä–æ —Ä–µ–π—Å–∏ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Apache Spark

–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –≤–µ–ª–∏–∫–∏–π —Ñ–∞–π–ª `flights_2014.csv` (253 316 —Ä—è–¥–∫—ñ–≤), —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –ø—Ä–æ –≤—Å—ñ —Ä–µ–π—Å–∏, —â–æ –≤–∏–ª—ñ—Ç–∞–ª–∏ –∑ –∞–µ—Ä–æ–ø–æ—Ä—Ç—ñ–≤ –ù—å—é-–ô–æ—Ä–∫–∞ —É 2014 —Ä–æ—Ü—ñ (–¥–∞–Ω—ñ –∑ `nycflights14`). –í–∞—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ–π —É **—Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ Apache Spark**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ª–∏—à–µ R-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `sparklyr`.

------------------------------------------------------------------------

### üìå –ó–∞–≤–¥–∞–Ω–Ω—è

#### **–ï—Ç–∞–ø 1: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è**

-   –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Java 8, –ø–∞–∫–µ—Ç `sparklyr` —Ç–∞ Spark (–≤–µ—Ä—Å—ñ—è 3.3.2) —á–µ—Ä–µ–∑ `spark_install()`.\
-   –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ **–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Spark** —á–µ—Ä–µ–∑ `spark_connect(master = "local")`.

```{r}
#install.packages("sparklyr")
# create connection object Spark Context
if (!requireNamespace("sparklyr", quietly = TRUE)) {
  install.packages("sparklyr")
}
library(dplyr)
library(DBI)
library("sparklyr")

tryCatch({
  spark_install(version = "3.3.2")
}, error = function(e) {
  message("Spark version 3.3.2 already installed or error installation: ", conditionMessage(e))
})

sc <- spark_connect(
  master = "local",
  config = spark_config()
)

message("successful connection")
print(sc)
```

#### **–ï—Ç–∞–ø 2: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö**

-   –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–∞–π–ª `flights_2014.csv` —É Spark —á–µ—Ä–µ–∑ `copy_to()` –∞–±–æ `spark_read_csv()`.\
-   –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ç–∞–±–ª–∏—Ü—è –¥–æ—Å—Ç—É–ø–Ω–∞ —É Spark (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `glimpse()` –∞–±–æ `count()`).

```{r}
relative_path <- "data/flights14.csv"

# normalizePath for Spark/Java
file_path <- normalizePath(relative_path)
message(paste0("absolute path for Spark: ", file_path))

message(paste0("loading file: ", file_path, " to Spark..."))

flights_tbl <- spark_read_csv(
  sc,
  name = "flights_2014",      # table name Spark
  path = file_path,
  header = TRUE,
  infer_schema = TRUE,         # automatic define datatypes
  memory = TRUE,               # cashing Spark
)

message("data was loaded to Spark. table name: flights_2014")

message("table structure in Spark:")
glimpse(flights_tbl)

message("number of rows in the table:")
row_count <- flights_tbl %>% 
  tally() %>% 
  collect()

message(paste("total number of rows (from Spark):", row_count$n))

```

#### **–ï—Ç–∞–ø 3: –ê–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ dplyr-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

–í–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó **—É Spark**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `dplyr`:\
- –í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–π—Ç–µ —Ä–µ–π—Å–∏ –∑ –∞–µ—Ä–æ–ø–æ—Ä—Ç—É **JFK**, –¥–µ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É (`dep_delay`) \> 60 —Ö–≤.\
- –û–±—á–∏—Å–ª—ñ—Ç—å **—Å–µ—Ä–µ–¥–Ω—î –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –≤–∏–ª—å–æ—Ç—É** –∑–∞ –∫–æ–∂–Ω–æ—é –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—î—é (`carrier`).\
- –í—ñ–¥—Å–æ—Ä—Ç—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ —Å–ø–∞–¥–∞–Ω–Ω—è–º —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è.\
- –í–∏–±–µ—Ä—ñ—Ç—å **—Ç–æ–ø-5 –∞–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ–π** –∑ –Ω–∞–π–±—ñ–ª—å—à–∏–º –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è–º.

```{r}
message("analizeing: searching top-5 airlines with the biggest deley...")

top_carriers_spark <- flights_tbl %>%
  filter(origin == "JFK", dep_delay > 60) %>%

  # avarage deley for each airline (carrier)
  group_by(carrier) %>%
  summarise(avg_dep_delay = mean(dep_delay, na.rm = TRUE)) %>%

  # sorting
  arrange(desc(avg_dep_delay)) %>%

  # 4. choosing top-5
  head(5)

print(top_carriers_spark)
```

#### **–ï—Ç–∞–ø 4: –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É R**

-   –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É R —á–µ—Ä–µ–∑ `collect()`.\
-   –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Ü–µ `data.frame` –∑ 5 —Ä—è–¥–∫–∞–º–∏.

```{r}
message("top-5 results in R data.frame using collect()...")
top_carriers_r <- top_carriers_spark %>%
  collect()

message("result structure in R:")
print(top_carriers_r)

message(paste0("number of rows in R data.frame: ", nrow(top_carriers_r)))

if (is.data.frame(top_carriers_r) && nrow(top_carriers_r) == 5) {
  message("succesful: got R data.frame with 5 rows")
} else {
  message("fail: 5 rows expected ")
}
```

#### **–ï—Ç–∞–ø 5: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

-   –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Spark —á–µ—Ä–µ–∑ `spark_web(sc)`.\
-   –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
    -   —á–∏ –∑‚Äô—è–≤–∏–≤—Å—è –≤–∞—à –¥–∞—Ç–∞—Ñ—Ä–µ–π–º —É –≤–∫–ª–∞–¥—Ü—ñ **Storage**\
    -   —á–∏ –≤–∏–∫–æ–Ω–∞–≤—Å—è –∑–∞–ø–∏—Ç —É –≤–∫–ª–∞–¥—Ü—ñ **Jobs**\
    -   —Å–∫—ñ–ª—å–∫–∏ –ø–∞–º‚Äô—è—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è (–≤–∫–ª–∞–¥–∫–∞ **Executors**).

```{r}
spark_web(sc)
```

–î–∞—Ç–∞—Ñ—Ä–µ–π–º –∑'—è–≤–∏–≤—Å—è —É –≤–∫–ª–∞–¥—Ü—ñ **Storage**

–ó–∞–ø–∏—Ç –≤–∏–∫–æ–Ω–∞–≤—Å—è —É –≤–∫–ª–∞–¥—Ü—ñ **Jobs**

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ - 3.3 MiB / 912.3 MiB

#### **–ï—Ç–∞–ø 6: –í—ñ–¥‚Äô—î–¥–Ω–∞–Ω–Ω—è**

-   –ö–æ—Ä–µ–∫—Ç–Ω–æ –≤—ñ–¥‚Äô—î–¥–Ω–∞–π—Ç–µ—Å—è –≤—ñ–¥ –∫–ª–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ `spark_disconnect(sc)`.

```{r}
message("disconnect from Spark...")
spark_disconnect(sc)
message("disconnect ended. Spark session was closed")

rm(sc, flights_tbl, top_carriers_spark, top_carriers_r)
```

------------------------------------------------------------------------

### üí° –¢–µ—Ö–Ω—ñ—á–Ω—ñ –≤–∏–º–æ–≥–∏

-   –£–≤–µ—Å—å –∞–Ω–∞–ª—ñ–∑ –º–∞—î –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏–π **–≤–∏–∫–ª—é—á–Ω–æ —á–µ—Ä–µ–∑ `sparklyr`**.\
-   **–ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `dplyr` –±–µ–∑ Spark-–±–µ–∫–µ–Ω–¥—É** –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π.\
-   –£—Å—ñ —Ñ–∞–π–ª–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑ –ø–∞–ø–∫–∏ `data/`.\
-   –ö–æ–¥ –º–∞—î –±—É—Ç–∏ **–≤—ñ–¥—Ç–≤–æ—Ä—é–≤–∞–Ω–∏–º** —Ç–∞ **–ø–∞–º‚Äô—è—Ç—å-–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º** (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `collect()` –Ω–∞ –ø–æ–≤–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ!).

```{=html}
<hr style="border: 1px solid #ddd; margin: 30px 0 10px 0;">
<footer style="text-align: center; font-size: 0.9em; color: #666; padding: 15px; background: #f9f9f9; border-top: 1px solid #eee; margin-top: 20px;">
  <p><strong>–í–∏–∫–æ–Ω–∞–≤(–ª–∞): –ú–∞—Ä–∏–Ω—á–µ–Ω–∫–æ –í–∞–ª–µ—Ä—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞</strong> | –ì—Ä—É–ø–∞: <strong>–ö–Ü-24-1–º</strong> | –í–∏–∫–ª–∞–¥–∞—á: –°–∏–¥–æ—Ä–µ–Ω–∫–æ –í.–ú.</p>
  <p>–ö—Ä–µ–º–µ–Ω—á—É—Ü—å–∫–∏–π –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç —ñ–º–µ–Ω—ñ –ú–∏—Ö–∞–π–ª–∞ –û—Å—Ç—Ä–æ–≥—Ä–∞–¥—Å—å–∫–æ–≥–æ &copy; 2025</p>
</footer>
```
